var IsariBackend;(()=>{"use strict";var e={696:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertChangesToDMP=function(e){for(var t,n,r=[],s=0;s<e.length;s++)n=(t=e[s]).added?1:t.removed?-1:0,r.push([n,t.value]);return r}},826:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertChangesToXML=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r.added?t.push("<ins>"):r.removed&&t.push("<del>"),t.push((s=r.value,void 0,s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"))),r.added?t.push("</ins>"):r.removed&&t.push("</del>")}var s;return t.join("")}},976:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffArrays=function(e,t,n){return s.diff(e,t,n)},t.arrayDiff=void 0;var s=new(((r=n(913))&&r.__esModule?r:{default:r}).default);t.arrayDiff=s,s.tokenize=function(e){return e.slice()},s.join=s.removeEmpty=function(e){return e}},913:(e,t)=>{function n(){}function r(e,t,n,r,s){for(var i=0,o=t.length,l=0,c=0;i<o;i++){var a=t[i];if(a.removed){if(a.value=e.join(r.slice(c,c+a.count)),c+=a.count,i&&t[i-1].added){var h=t[i-1];t[i-1]=t[i],t[i]=h}}else{if(!a.added&&s){var u=n.slice(l,l+a.count);u=u.map((function(e,t){var n=r[c+t];return n.length>e.length?n:e})),a.value=e.join(u)}else a.value=e.join(n.slice(l,l+a.count));l+=a.count,a.added||(c+=a.count)}}var d=t[o-1];return o>1&&"string"==typeof d.value&&(d.added||d.removed)&&e.equals("",d.value)&&(t[o-2].value+=d.value,t.pop()),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n,n.prototype={diff:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=n.callback;"function"==typeof n&&(s=n,n={}),this.options=n;var i=this;function o(e){return s?(setTimeout((function(){s(void 0,e)}),0),!0):e}e=this.castInput(e),t=this.castInput(t),e=this.removeEmpty(this.tokenize(e));var l=(t=this.removeEmpty(this.tokenize(t))).length,c=e.length,a=1,h=l+c;n.maxEditLength&&(h=Math.min(h,n.maxEditLength));var u=[{newPos:-1,components:[]}],d=this.extractCommon(u[0],t,e,0);if(u[0].newPos+1>=l&&d+1>=c)return o([{value:this.join(t),count:t.length}]);function f(){for(var n=-1*a;n<=a;n+=2){var s=void 0,h=u[n-1],d=u[n+1],f=(d?d.newPos:0)-n;h&&(u[n-1]=void 0);var g=h&&h.newPos+1<l,p=d&&0<=f&&f<c;if(g||p){if(!g||p&&h.newPos<d.newPos?(s={newPos:(w=d).newPos,components:w.components.slice(0)},i.pushComponent(s.components,void 0,!0)):((s=h).newPos++,i.pushComponent(s.components,!0,void 0)),f=i.extractCommon(s,t,e,n),s.newPos+1>=l&&f+1>=c)return o(r(i,s.components,t,e,i.useLongestToken));u[n]=s}else u[n]=void 0}var w;a++}if(s)!function e(){setTimeout((function(){if(a>h)return s();f()||e()}),0)}();else for(;a<=h;){var g=f();if(g)return g}},pushComponent:function(e,t,n){var r=e[e.length-1];r&&r.added===t&&r.removed===n?e[e.length-1]={count:r.count+1,added:t,removed:n}:e.push({count:1,added:t,removed:n})},extractCommon:function(e,t,n,r){for(var s=t.length,i=n.length,o=e.newPos,l=o-r,c=0;o+1<s&&l+1<i&&this.equals(t[o+1],n[l+1]);)o++,l++,c++;return c&&e.components.push({count:c}),e.newPos=o,l},equals:function(e,t){return this.options.comparator?this.options.comparator(e,t):e===t||this.options.ignoreCase&&e.toLowerCase()===t.toLowerCase()},removeEmpty:function(e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(e[n]);return t},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}}},630:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffChars=function(e,t,n){return s.diff(e,t,n)},t.characterDiff=void 0;var s=new(((r=n(913))&&r.__esModule?r:{default:r}).default);t.characterDiff=s},852:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffCss=function(e,t,n){return s.diff(e,t,n)},t.cssDiff=void 0;var s=new(((r=n(913))&&r.__esModule?r:{default:r}).default);t.cssDiff=s,s.tokenize=function(e){return e.split(/([{}:;,]|\s+)/)}},276:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffJson=function(e,t,n){return c.diff(e,t,n)},t.canonicalize=a,t.jsonDiff=void 0;var r,s=(r=n(913))&&r.__esModule?r:{default:r},i=n(187);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var l=Object.prototype.toString,c=new s.default;function a(e,t,n,r,s){var i,c;for(t=t||[],n=n||[],r&&(e=r(s,e)),i=0;i<t.length;i+=1)if(t[i]===e)return n[i];if("[object Array]"===l.call(e)){for(t.push(e),c=new Array(e.length),n.push(c),i=0;i<e.length;i+=1)c[i]=a(e[i],t,n,r,s);return t.pop(),n.pop(),c}if(e&&e.toJSON&&(e=e.toJSON()),"object"===o(e)&&null!==e){t.push(e),c={},n.push(c);var h,u=[];for(h in e)e.hasOwnProperty(h)&&u.push(h);for(u.sort(),i=0;i<u.length;i+=1)c[h=u[i]]=a(e[h],t,n,r,h);t.pop(),n.pop()}else c=e;return c}t.jsonDiff=c,c.useLongestToken=!0,c.tokenize=i.lineDiff.tokenize,c.castInput=function(e){var t=this.options,n=t.undefinedReplacement,r=t.stringifyReplacer,s=void 0===r?function(e,t){return void 0===t?n:t}:r;return"string"==typeof e?e:JSON.stringify(a(e,null,null,s),s,"  ")},c.equals=function(e,t){return s.default.prototype.equals.call(c,e.replace(/,([\r\n])/g,"$1"),t.replace(/,([\r\n])/g,"$1"))}},187:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffLines=function(e,t,n){return o.diff(e,t,n)},t.diffTrimmedLines=function(e,t,n){var r=(0,i.generateOptions)(n,{ignoreWhitespace:!0});return o.diff(e,t,r)},t.lineDiff=void 0;var r,s=(r=n(913))&&r.__esModule?r:{default:r},i=n(9),o=new s.default;t.lineDiff=o,o.tokenize=function(e){var t=[],n=e.split(/(\n|\r\n)/);n[n.length-1]||n.pop();for(var r=0;r<n.length;r++){var s=n[r];r%2&&!this.options.newlineIsToken?t[t.length-1]+=s:(this.options.ignoreWhitespace&&(s=s.trim()),t.push(s))}return t}},146:(e,t,n)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.diffSentences=function(e,t,n){return s.diff(e,t,n)},t.sentenceDiff=void 0;var s=new(((r=n(913))&&r.__esModule?r:{default:r}).default);t.sentenceDiff=s,s.tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)}},303:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diffWords=function(e,t,n){return n=(0,i.generateOptions)(n,{ignoreWhitespace:!0}),c.diff(e,t,n)},t.diffWordsWithSpace=function(e,t,n){return c.diff(e,t,n)},t.wordDiff=void 0;var r,s=(r=n(913))&&r.__esModule?r:{default:r},i=n(9),o=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,l=/\S/,c=new s.default;t.wordDiff=c,c.equals=function(e,t){return this.options.ignoreCase&&(e=e.toLowerCase(),t=t.toLowerCase()),e===t||this.options.ignoreWhitespace&&!l.test(e)&&!l.test(t)},c.tokenize=function(e){for(var t=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&o.test(t[n])&&o.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}},479:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Diff",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"diffChars",{enumerable:!0,get:function(){return i.diffChars}}),Object.defineProperty(t,"diffWords",{enumerable:!0,get:function(){return o.diffWords}}),Object.defineProperty(t,"diffWordsWithSpace",{enumerable:!0,get:function(){return o.diffWordsWithSpace}}),Object.defineProperty(t,"diffLines",{enumerable:!0,get:function(){return l.diffLines}}),Object.defineProperty(t,"diffTrimmedLines",{enumerable:!0,get:function(){return l.diffTrimmedLines}}),Object.defineProperty(t,"diffSentences",{enumerable:!0,get:function(){return c.diffSentences}}),Object.defineProperty(t,"diffCss",{enumerable:!0,get:function(){return a.diffCss}}),Object.defineProperty(t,"diffJson",{enumerable:!0,get:function(){return h.diffJson}}),Object.defineProperty(t,"canonicalize",{enumerable:!0,get:function(){return h.canonicalize}}),Object.defineProperty(t,"diffArrays",{enumerable:!0,get:function(){return u.diffArrays}}),Object.defineProperty(t,"applyPatch",{enumerable:!0,get:function(){return d.applyPatch}}),Object.defineProperty(t,"applyPatches",{enumerable:!0,get:function(){return d.applyPatches}}),Object.defineProperty(t,"parsePatch",{enumerable:!0,get:function(){return f.parsePatch}}),Object.defineProperty(t,"merge",{enumerable:!0,get:function(){return g.merge}}),Object.defineProperty(t,"structuredPatch",{enumerable:!0,get:function(){return p.structuredPatch}}),Object.defineProperty(t,"createTwoFilesPatch",{enumerable:!0,get:function(){return p.createTwoFilesPatch}}),Object.defineProperty(t,"createPatch",{enumerable:!0,get:function(){return p.createPatch}}),Object.defineProperty(t,"convertChangesToDMP",{enumerable:!0,get:function(){return w.convertChangesToDMP}}),Object.defineProperty(t,"convertChangesToXML",{enumerable:!0,get:function(){return m.convertChangesToXML}});var r,s=(r=n(913))&&r.__esModule?r:{default:r},i=n(630),o=n(303),l=n(187),c=n(146),a=n(852),h=n(276),u=n(976),d=n(690),f=n(719),g=n(51),p=n(286),w=n(696),m=n(826)},690:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.applyPatch=o,t.applyPatches=function(e,t){"string"==typeof e&&(e=(0,s.parsePatch)(e));var n=0;!function r(){var s=e[n++];if(!s)return t.complete();t.loadFile(s,(function(e,n){if(e)return t.complete(e);var i=o(n,s,t);t.patched(s,i,(function(e){if(e)return t.complete(e);r()}))}))}()};var r,s=n(719),i=(r=n(169))&&r.__esModule?r:{default:r};function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof t&&(t=(0,s.parsePatch)(t)),Array.isArray(t)){if(t.length>1)throw new Error("applyPatch only works with a single input.");t=t[0]}var r,o,l=e.split(/\r\n|[\n\v\f\r\x85]/),c=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],a=t.hunks,h=n.compareLine||function(e,t,n,r){return t===r},u=0,d=n.fuzzFactor||0,f=0,g=0;function p(e,t){for(var n=0;n<e.lines.length;n++){var r=e.lines[n],s=r.length>0?r[0]:" ",i=r.length>0?r.substr(1):r;if(" "===s||"-"===s){if(!h(t+1,l[t],s,i)&&++u>d)return!1;t++}}return!0}for(var w=0;w<a.length;w++){for(var m=a[w],y=l.length-m.oldLines,b=0,v=g+m.oldStart-1,_=(0,i.default)(v,f,y);void 0!==b;b=_())if(p(m,v+b)){m.offset=g+=b;break}if(void 0===b)return!1;f=m.offset+m.oldStart+m.oldLines}for(var k=0,S=0;S<a.length;S++){var E=a[S],C=E.oldStart+E.offset+k-1;k+=E.newLines-E.oldLines;for(var D=0;D<E.lines.length;D++){var x=E.lines[D],M=x.length>0?x[0]:" ",I=x.length>0?x.substr(1):x,L=E.linedelimiters[D];if(" "===M)C++;else if("-"===M)l.splice(C,1),c.splice(C,1);else if("+"===M)l.splice(C,0,I),c.splice(C,0,L),C++;else if("\\"===M){var O=E.lines[D-1]?E.lines[D-1][0]:null;"+"===O?r=!0:"-"===O&&(o=!0)}}}if(r)for(;!l[l.length-1];)l.pop(),c.pop();else o&&(l.push(""),c.push("\n"));for(var A=0;A<l.length-1;A++)l[A]=l[A]+c[A];return l.join("")}},286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.structuredPatch=o,t.formatPatch=l,t.createTwoFilesPatch=c,t.createPatch=function(e,t,n,r,s,i){return c(e,e,t,n,r,s,i)};var r=n(187);function s(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t,n,i,o,l,c){c||(c={}),void 0===c.context&&(c.context=4);var a=(0,r.diffLines)(n,i,c);if(a){a.push({value:"",lines:[]});for(var h=[],u=0,d=0,f=[],g=1,p=1,w=function(e){var t=a[e],r=t.lines||t.value.replace(/\n$/,"").split("\n");if(t.lines=r,t.added||t.removed){var o;if(!u){var l=a[e-1];u=g,d=p,l&&(f=c.context>0?y(l.lines.slice(-c.context)):[],u-=f.length,d-=f.length)}(o=f).push.apply(o,s(r.map((function(e){return(t.added?"+":"-")+e})))),t.added?p+=r.length:g+=r.length}else{if(u)if(r.length<=2*c.context&&e<a.length-2){var w;(w=f).push.apply(w,s(y(r)))}else{var m,b=Math.min(r.length,c.context);(m=f).push.apply(m,s(y(r.slice(0,b))));var v={oldStart:u,oldLines:g-u+b,newStart:d,newLines:p-d+b,lines:f};if(e>=a.length-2&&r.length<=c.context){var _=/\n$/.test(n),k=/\n$/.test(i),S=0==r.length&&f.length>v.oldLines;!_&&S&&n.length>0&&f.splice(v.oldLines,0,"\\ No newline at end of file"),(_||S)&&k||f.push("\\ No newline at end of file")}h.push(v),u=0,d=0,f=[]}g+=r.length,p+=r.length}},m=0;m<a.length;m++)w(m);return{oldFileName:e,newFileName:t,oldHeader:o,newHeader:l,hunks:h}}function y(e){return e.map((function(e){return" "+e}))}}function l(e){var t=[];e.oldFileName==e.newFileName&&t.push("Index: "+e.oldFileName),t.push("==================================================================="),t.push("--- "+e.oldFileName+(void 0===e.oldHeader?"":"\t"+e.oldHeader)),t.push("+++ "+e.newFileName+(void 0===e.newHeader?"":"\t"+e.newHeader));for(var n=0;n<e.hunks.length;n++){var r=e.hunks[n];0===r.oldLines&&(r.oldStart-=1),0===r.newLines&&(r.newStart-=1),t.push("@@ -"+r.oldStart+","+r.oldLines+" +"+r.newStart+","+r.newLines+" @@"),t.push.apply(t,r.lines)}return t.join("\n")+"\n"}function c(e,t,n,r,s,i,c){return l(o(e,t,n,r,s,i,c))}},51:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.calcLineCount=c,t.merge=function(e,t,n){e=a(e,n),t=a(t,n);var r={};(e.index||t.index)&&(r.index=e.index||t.index),(e.newFileName||t.newFileName)&&(h(e)?h(t)?(r.oldFileName=u(r,e.oldFileName,t.oldFileName),r.newFileName=u(r,e.newFileName,t.newFileName),r.oldHeader=u(r,e.oldHeader,t.oldHeader),r.newHeader=u(r,e.newHeader,t.newHeader)):(r.oldFileName=e.oldFileName,r.newFileName=e.newFileName,r.oldHeader=e.oldHeader,r.newHeader=e.newHeader):(r.oldFileName=t.oldFileName||e.oldFileName,r.newFileName=t.newFileName||e.newFileName,r.oldHeader=t.oldHeader||e.oldHeader,r.newHeader=t.newHeader||e.newHeader)),r.hunks=[];for(var s=0,i=0,o=0,l=0;s<e.hunks.length||i<t.hunks.length;){var c=e.hunks[s]||{oldStart:1/0},p=t.hunks[i]||{oldStart:1/0};if(d(c,p))r.hunks.push(f(c,o)),s++,l+=c.newLines-c.oldLines;else if(d(p,c))r.hunks.push(f(p,l)),i++,o+=p.newLines-p.oldLines;else{var w={oldStart:Math.min(c.oldStart,p.oldStart),oldLines:0,newStart:Math.min(c.newStart+o,p.oldStart+l),newLines:0,lines:[]};g(w,c.oldStart,c.lines,p.oldStart,p.lines),i++,s++,r.hunks.push(w)}}return r};var r=n(286),s=n(719),i=n(780);function o(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e){var t=S(e.lines),n=t.oldLines,r=t.newLines;void 0!==n?e.oldLines=n:delete e.oldLines,void 0!==r?e.newLines=r:delete e.newLines}function a(e,t){if("string"==typeof e){if(/^@@/m.test(e)||/^Index:/m.test(e))return(0,s.parsePatch)(e)[0];if(!t)throw new Error("Must provide a base reference or pass in a patch");return(0,r.structuredPatch)(void 0,void 0,t,e)}return e}function h(e){return e.newFileName&&e.newFileName!==e.oldFileName}function u(e,t,n){return t===n?t:(e.conflict=!0,{mine:t,theirs:n})}function d(e,t){return e.oldStart<t.oldStart&&e.oldStart+e.oldLines<t.oldStart}function f(e,t){return{oldStart:e.oldStart,oldLines:e.oldLines,newStart:e.newStart+t,newLines:e.newLines,lines:e.lines}}function g(e,t,n,r,s){var i={offset:t,lines:n,index:0},l={offset:r,lines:s,index:0};for(y(e,i,l),y(e,l,i);i.index<i.lines.length&&l.index<l.lines.length;){var a=i.lines[i.index],h=l.lines[l.index];if("-"!==a[0]&&"+"!==a[0]||"-"!==h[0]&&"+"!==h[0])if("+"===a[0]&&" "===h[0]){var u;(u=e.lines).push.apply(u,o(v(i)))}else if("+"===h[0]&&" "===a[0]){var d;(d=e.lines).push.apply(d,o(v(l)))}else"-"===a[0]&&" "===h[0]?w(e,i,l):"-"===h[0]&&" "===a[0]?w(e,l,i,!0):a===h?(e.lines.push(a),i.index++,l.index++):m(e,v(i),v(l));else p(e,i,l)}b(e,i),b(e,l),c(e)}function p(e,t,n){var r=v(t),s=v(n);if(_(r)&&_(s)){var l,c;if((0,i.arrayStartsWith)(r,s)&&k(n,r,r.length-s.length))return void(l=e.lines).push.apply(l,o(r));if((0,i.arrayStartsWith)(s,r)&&k(t,s,s.length-r.length))return void(c=e.lines).push.apply(c,o(s))}else if((0,i.arrayEqual)(r,s)){var a;return void(a=e.lines).push.apply(a,o(r))}m(e,r,s)}function w(e,t,n,r){var s,i=v(t),l=function(e,t){for(var n=[],r=[],s=0,i=!1,o=!1;s<t.length&&e.index<e.lines.length;){var l=e.lines[e.index],c=t[s];if("+"===c[0])break;if(i=i||" "!==l[0],r.push(c),s++,"+"===l[0])for(o=!0;"+"===l[0];)n.push(l),l=e.lines[++e.index];c.substr(1)===l.substr(1)?(n.push(l),e.index++):o=!0}if("+"===(t[s]||"")[0]&&i&&(o=!0),o)return n;for(;s<t.length;)r.push(t[s++]);return{merged:r,changes:n}}(n,i);l.merged?(s=e.lines).push.apply(s,o(l.merged)):m(e,r?l:i,r?i:l)}function m(e,t,n){e.conflict=!0,e.lines.push({conflict:!0,mine:t,theirs:n})}function y(e,t,n){for(;t.offset<n.offset&&t.index<t.lines.length;){var r=t.lines[t.index++];e.lines.push(r),t.offset++}}function b(e,t){for(;t.index<t.lines.length;){var n=t.lines[t.index++];e.lines.push(n)}}function v(e){for(var t=[],n=e.lines[e.index][0];e.index<e.lines.length;){var r=e.lines[e.index];if("-"===n&&"+"===r[0]&&(n="+"),n!==r[0])break;t.push(r),e.index++}return t}function _(e){return e.reduce((function(e,t){return e&&"-"===t[0]}),!0)}function k(e,t,n){for(var r=0;r<n;r++){var s=t[t.length-n+r].substr(1);if(e.lines[e.index+r]!==" "+s)return!1}return e.index+=n,!0}function S(e){var t=0,n=0;return e.forEach((function(e){if("string"!=typeof e){var r=S(e.mine),s=S(e.theirs);void 0!==t&&(r.oldLines===s.oldLines?t+=r.oldLines:t=void 0),void 0!==n&&(r.newLines===s.newLines?n+=r.newLines:n=void 0)}else void 0===n||"+"!==e[0]&&" "!==e[0]||n++,void 0===t||"-"!==e[0]&&" "!==e[0]||t++})),{oldLines:t,newLines:n}}},719:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parsePatch=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.split(/\r\n|[\n\v\f\r\x85]/),r=e.match(/\r\n|[\n\v\f\r\x85]/g)||[],s=[],i=0;function o(){var e={};for(s.push(e);i<n.length;){var r=n[i];if(/^(\-\-\-|\+\+\+|@@)\s/.test(r))break;var o=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(r);o&&(e.index=o[1]),i++}for(l(e),l(e),e.hunks=[];i<n.length;){var a=n[i];if(/^(Index:|diff|\-\-\-|\+\+\+)\s/.test(a))break;if(/^@@/.test(a))e.hunks.push(c());else{if(a&&t.strict)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(a));i++}}}function l(e){var t=/^(---|\+\+\+)\s+(.*)$/.exec(n[i]);if(t){var r="---"===t[1]?"old":"new",s=t[2].split("\t",2),o=s[0].replace(/\\\\/g,"\\");/^".*"$/.test(o)&&(o=o.substr(1,o.length-2)),e[r+"FileName"]=o,e[r+"Header"]=(s[1]||"").trim(),i++}}function c(){var e=i,s=n[i++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),o={oldStart:+s[1],oldLines:void 0===s[2]?1:+s[2],newStart:+s[3],newLines:void 0===s[4]?1:+s[4],lines:[],linedelimiters:[]};0===o.oldLines&&(o.oldStart+=1),0===o.newLines&&(o.newStart+=1);for(var l=0,c=0;i<n.length&&!(0===n[i].indexOf("--- ")&&i+2<n.length&&0===n[i+1].indexOf("+++ ")&&0===n[i+2].indexOf("@@"));i++){var a=0==n[i].length&&i!=n.length-1?" ":n[i][0];if("+"!==a&&"-"!==a&&" "!==a&&"\\"!==a)break;o.lines.push(n[i]),o.linedelimiters.push(r[i]||"\n"),"+"===a?l++:"-"===a?c++:" "===a&&(l++,c++)}if(l||1!==o.newLines||(o.newLines=0),c||1!==o.oldLines||(o.oldLines=0),t.strict){if(l!==o.newLines)throw new Error("Added line count did not match for hunk at line "+(e+1));if(c!==o.oldLines)throw new Error("Removed line count did not match for hunk at line "+(e+1))}return o}for(;i<n.length;)o();return s}},780:(e,t)=>{function n(e,t){if(t.length>e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.arrayEqual=function(e,t){return e.length===t.length&&n(e,t)},t.arrayStartsWith=n},169:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=!0,s=!1,i=!1,o=1;return function l(){if(r&&!i){if(s?o++:r=!1,e+o<=n)return o;i=!0}if(!s)return i||(r=!0),t<=e-o?-o++:(s=!0,l())}}},9:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateOptions=function(e,t){if("function"==typeof e)t.callback=e;else if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}},429:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NIL",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"validate",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"version",{enumerable:!0,get:function(){return c.default}});var r=d(n(990)),s=d(n(237)),i=d(n(355)),o=d(n(764)),l=d(n(314)),c=d(n(464)),a=d(n(435)),h=d(n(8)),u=d(n(222));function d(e){return e&&e.__esModule?e:{default:e}}},163:(e,t)=>{function n(e){return 14+(e+64>>>9<<4)+1}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function s(e,t,n,s,i,o){return r((l=r(r(t,e),r(s,o)))<<(c=i)|l>>>32-c,n);var l,c}function i(e,t,n,r,i,o,l){return s(t&n|~t&r,e,t,i,o,l)}function o(e,t,n,r,i,o,l){return s(t&r|n&~r,e,t,i,o,l)}function l(e,t,n,r,i,o,l){return s(t^n^r,e,t,i,o,l)}function c(e,t,n,r,i,o,l){return s(n^(t|~r),e,t,i,o,l)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let n=0;n<t.length;++n)e[n]=t.charCodeAt(n)}return function(e){const t=[],n=32*e.length,r="0123456789abcdef";for(let s=0;s<n;s+=8){const n=e[s>>5]>>>s%32&255,i=parseInt(r.charAt(n>>>4&15)+r.charAt(15&n),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[n(t)-1]=t;let s=1732584193,a=-271733879,h=-1732584194,u=271733878;for(let t=0;t<e.length;t+=16){const n=s,d=a,f=h,g=u;s=i(s,a,h,u,e[t],7,-680876936),u=i(u,s,a,h,e[t+1],12,-389564586),h=i(h,u,s,a,e[t+2],17,606105819),a=i(a,h,u,s,e[t+3],22,-1044525330),s=i(s,a,h,u,e[t+4],7,-176418897),u=i(u,s,a,h,e[t+5],12,1200080426),h=i(h,u,s,a,e[t+6],17,-1473231341),a=i(a,h,u,s,e[t+7],22,-45705983),s=i(s,a,h,u,e[t+8],7,1770035416),u=i(u,s,a,h,e[t+9],12,-1958414417),h=i(h,u,s,a,e[t+10],17,-42063),a=i(a,h,u,s,e[t+11],22,-1990404162),s=i(s,a,h,u,e[t+12],7,1804603682),u=i(u,s,a,h,e[t+13],12,-40341101),h=i(h,u,s,a,e[t+14],17,-1502002290),a=i(a,h,u,s,e[t+15],22,1236535329),s=o(s,a,h,u,e[t+1],5,-165796510),u=o(u,s,a,h,e[t+6],9,-1069501632),h=o(h,u,s,a,e[t+11],14,643717713),a=o(a,h,u,s,e[t],20,-373897302),s=o(s,a,h,u,e[t+5],5,-701558691),u=o(u,s,a,h,e[t+10],9,38016083),h=o(h,u,s,a,e[t+15],14,-660478335),a=o(a,h,u,s,e[t+4],20,-405537848),s=o(s,a,h,u,e[t+9],5,568446438),u=o(u,s,a,h,e[t+14],9,-1019803690),h=o(h,u,s,a,e[t+3],14,-187363961),a=o(a,h,u,s,e[t+8],20,1163531501),s=o(s,a,h,u,e[t+13],5,-1444681467),u=o(u,s,a,h,e[t+2],9,-51403784),h=o(h,u,s,a,e[t+7],14,1735328473),a=o(a,h,u,s,e[t+12],20,-1926607734),s=l(s,a,h,u,e[t+5],4,-378558),u=l(u,s,a,h,e[t+8],11,-2022574463),h=l(h,u,s,a,e[t+11],16,1839030562),a=l(a,h,u,s,e[t+14],23,-35309556),s=l(s,a,h,u,e[t+1],4,-1530992060),u=l(u,s,a,h,e[t+4],11,1272893353),h=l(h,u,s,a,e[t+7],16,-155497632),a=l(a,h,u,s,e[t+10],23,-1094730640),s=l(s,a,h,u,e[t+13],4,681279174),u=l(u,s,a,h,e[t],11,-358537222),h=l(h,u,s,a,e[t+3],16,-722521979),a=l(a,h,u,s,e[t+6],23,76029189),s=l(s,a,h,u,e[t+9],4,-640364487),u=l(u,s,a,h,e[t+12],11,-421815835),h=l(h,u,s,a,e[t+15],16,530742520),a=l(a,h,u,s,e[t+2],23,-995338651),s=c(s,a,h,u,e[t],6,-198630844),u=c(u,s,a,h,e[t+7],10,1126891415),h=c(h,u,s,a,e[t+14],15,-1416354905),a=c(a,h,u,s,e[t+5],21,-57434055),s=c(s,a,h,u,e[t+12],6,1700485571),u=c(u,s,a,h,e[t+3],10,-1894986606),h=c(h,u,s,a,e[t+10],15,-1051523),a=c(a,h,u,s,e[t+1],21,-2054922799),s=c(s,a,h,u,e[t+8],6,1873313359),u=c(u,s,a,h,e[t+15],10,-30611744),h=c(h,u,s,a,e[t+6],15,-1560198380),a=c(a,h,u,s,e[t+13],21,1309151649),s=c(s,a,h,u,e[t+4],6,-145523070),u=c(u,s,a,h,e[t+11],10,-1120210379),h=c(h,u,s,a,e[t+2],15,718787259),a=c(a,h,u,s,e[t+9],21,-343485551),s=r(s,n),a=r(a,d),h=r(h,f),u=r(u,g)}return[s,a,h,u]}(function(e){if(0===e.length)return[];const t=8*e.length,r=new Uint32Array(n(t));for(let n=0;n<t;n+=8)r[n>>5]|=(255&e[n/8])<<n%32;return r}(e),8*e.length))}},790:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};t.default=n},314:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default="00000000-0000-0000-0000-000000000000"},222:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");let t;const n=new Uint8Array(16);return n[0]=(t=parseInt(e.slice(0,8),16))>>>24,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n[4]=(t=parseInt(e.slice(9,13),16))>>>8,n[5]=255&t,n[6]=(t=parseInt(e.slice(14,18),16))>>>8,n[7]=255&t,n[8]=(t=parseInt(e.slice(19,23),16))>>>8,n[9]=255&t,n[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,n[11]=t/4294967296&255,n[12]=t>>>24&255,n[13]=t>>>16&255,n[14]=t>>>8&255,n[15]=255&t,n}},58:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i},319:(e,t)=>{let n;Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!n&&(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!n))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)};const r=new Uint8Array(16)},757:(e,t)=>{function n(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:case 3:return t^n^r;case 2:return t&n^t&r^n&r}}function r(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){const t=[1518500249,1859775393,2400959708,3395469782],s=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const i=e.length/4+2,o=Math.ceil(i/16),l=new Array(o);for(let t=0;t<o;++t){const n=new Uint32Array(16);for(let r=0;r<16;++r)n[r]=e[64*t+4*r]<<24|e[64*t+4*r+1]<<16|e[64*t+4*r+2]<<8|e[64*t+4*r+3];l[t]=n}l[o-1][14]=8*(e.length-1)/Math.pow(2,32),l[o-1][14]=Math.floor(l[o-1][14]),l[o-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<o;++e){const i=new Uint32Array(80);for(let t=0;t<16;++t)i[t]=l[e][t];for(let e=16;e<80;++e)i[e]=r(i[e-3]^i[e-8]^i[e-14]^i[e-16],1);let o=s[0],c=s[1],a=s[2],h=s[3],u=s[4];for(let e=0;e<80;++e){const s=Math.floor(e/20),l=r(o,5)+n(s,c,a,h)+u+t[s]+i[e]>>>0;u=h,h=a,a=r(c,30)>>>0,c=o,o=l}s[0]=s[0]+o>>>0,s[1]=s[1]+c>>>0,s[2]=s[2]+a>>>0,s[3]=s[3]+h>>>0,s[4]=s[4]+u>>>0}return[s[0]>>24&255,s[0]>>16&255,s[0]>>8&255,255&s[0],s[1]>>24&255,s[1]>>16&255,s[1]>>8&255,255&s[1],s[2]>>24&255,s[2]>>16&255,s[2]>>8&255,255&s[2],s[3]>>24&255,s[3]>>16&255,s[3]>>8&255,255&s[3],s[4]>>24&255,s[4]>>16&255,s[4]>>8&255,255&s[4]]}},8:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.unsafeStringify=o;var r,s=(r=n(435))&&r.__esModule?r:{default:r};const i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));function o(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}t.default=function(e,t=0){const n=o(e,t);if(!(0,s.default)(n))throw TypeError("Stringified UUID is invalid");return n}},990:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(319))&&r.__esModule?r:{default:r},i=n(8);let o,l,c=0,a=0;t.default=function(e,t,n){let r=t&&n||0;const h=t||new Array(16);let u=(e=e||{}).node||o,d=void 0!==e.clockseq?e.clockseq:l;if(null==u||null==d){const t=e.random||(e.rng||s.default)();null==u&&(u=o=[1|t[0],t[1],t[2],t[3],t[4],t[5]]),null==d&&(d=l=16383&(t[6]<<8|t[7]))}let f=void 0!==e.msecs?e.msecs:Date.now(),g=void 0!==e.nsecs?e.nsecs:a+1;const p=f-c+(g-a)/1e4;if(p<0&&void 0===e.clockseq&&(d=d+1&16383),(p<0||f>c)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=f,a=g,l=d,f+=122192928e5;const w=(1e4*(268435455&f)+g)%4294967296;h[r++]=w>>>24&255,h[r++]=w>>>16&255,h[r++]=w>>>8&255,h[r++]=255&w;const m=f/4294967296*1e4&268435455;h[r++]=m>>>8&255,h[r++]=255&m,h[r++]=m>>>24&15|16,h[r++]=m>>>16&255,h[r++]=d>>>8|128,h[r++]=255&d;for(let e=0;e<6;++e)h[r+e]=u[e];return t||(0,i.unsafeStringify)(h)}},237:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(925)),s=i(n(163));function i(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v3",48,s.default);t.default=o},925:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.URL=t.DNS=void 0,t.default=function(e,t,n){function r(e,r,o,l){var c;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t}(e)),"string"==typeof r&&(r=(0,i.default)(r)),16!==(null===(c=r)||void 0===c?void 0:c.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let a=new Uint8Array(16+e.length);if(a.set(r),a.set(e,r.length),a=n(a),a[6]=15&a[6]|t,a[8]=63&a[8]|128,o){l=l||0;for(let e=0;e<16;++e)o[l+e]=a[e];return o}return(0,s.unsafeStringify)(a)}try{r.name=e}catch(e){}return r.DNS=o,r.URL=l,r};var r,s=n(8),i=(r=n(222))&&r.__esModule?r:{default:r};const o="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=o;const l="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=l},355:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(790)),s=o(n(319)),i=n(8);function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t,n){if(r.default.randomUUID&&!t&&!e)return r.default.randomUUID();const o=(e=e||{}).random||(e.rng||s.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=o[e];return t}return(0,i.unsafeStringify)(o)}},764:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=i(n(925)),s=i(n(757));function i(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v5",80,s.default);t.default=o},435:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(58))&&r.__esModule?r:{default:r};t.default=function(e){return"string"==typeof e&&s.default.test(e)}},464:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=(r=n(435))&&r.__esModule?r:{default:r};t.default=function(e){if(!(0,s.default)(e))throw TypeError("Invalid UUID");return parseInt(e.slice(14,15),16)}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{n.d(r,{default:()=>fs});const e=()=>new Map,t=t=>{const n=e();return t.forEach(((e,t)=>{n.set(t,e)})),n},s=(e,t,n)=>{let r=e.get(t);return void 0===r&&e.set(t,r=n()),r},i=()=>new Set,o=e=>e[e.length-1],l=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},c=Array.from,a=Array.isArray;class h{constructor(){this._observers=e()}on(e,t){s(this._observers,e,i).add(t)}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(t,n){return c((this._observers.get(t)||e()).values()).forEach((e=>e(...n)))}destroy(){this._observers=e()}}const u=Math.floor,d=(Math.ceil,Math.abs),f=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(e,t)=>e<t?e:t),g=(e,t)=>e>t?e:t,p=(Number.isNaN,Math.pow),w=(Math.sign,e=>0!==e?e<0:1/e<0),m=String.fromCharCode,y=(String.fromCodePoint,m(65535),/^\s*/g),b=/([A-Z])/g,v=(e,t)=>(e=>e.replace(y,""))(e.replace(b,(e=>`${t}${(e=>e.toLowerCase())(e)}`))),_="undefined"!=typeof TextEncoder?new TextEncoder:null,k=_?e=>_.encode(e):e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let e=0;e<n;e++)r[e]=t.codePointAt(e);return r};let S="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});S&&1===S.decode(new Uint8Array).length&&(S=null);let E=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},C=!0;try{"undefined"!=typeof localStorage&&(E=localStorage,C=!1)}catch(e){}const D=E,x=Object.assign,M=Object.keys,I=e=>M(e).length,L=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),O=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&O(e,t,n+1)}},A=e=>e,N=(e,t)=>{if(null==e||null==t)return((e,t)=>e===t)(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!N(e.get(n),t.get(n)))return!1;break;case Object:if(I(e)!==I(t))return!1;for(const n in e)if(!L(e,n)||!N(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!N(e[n],t[n]))return!1;break;default:return!1}return!0},P="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name),j="undefined"!=typeof window&&"undefined"!=typeof document&&!P;let U;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);const T=[],R=t=>(()=>{if(void 0===U)if(P){U=e();const t=process.argv;let n=null;for(let e=0;e<t.length;e++){const r=t[e];"-"===r[0]?(null!==n&&U.set(n,""),n=r):null!==n?(U.set(n,r),n=null):T.push(r)}null!==n&&U.set(n,"")}else"object"==typeof location?(U=e(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,n]=e.split("=");U.set(`--${v(t,"-")}`,n),U.set(`-${v(t,"-")}`,n)}}))):U=e();return U})().has(t),F=e=>{return void 0===(t=P?process.env[e.toUpperCase()]:D.getItem(e))?null:t;var t};R("--"+"production")||F("production");const B=P&&(H=process.env.FORCE_COLOR,["true","1","2"].includes(H));var H;const $=!R("no-colors")&&(!P||process.stdout.isTTY||B)&&(!P||R("color")||B||null!==F("COLORTERM")||(F("TERM")||"").includes("color")),W=e=>new Uint8Array(e),z=(e,t,n)=>new Uint8Array(e,t,n),J=j?e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=m(e[n]);return btoa(t)}:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),V=j?e=>{const t=atob(e),n=W(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}:e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},q=64,K=128,Y=127,X=Number.MAX_SAFE_INTEGER,G=(Number.MIN_SAFE_INTEGER,Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&u(e)===e));Number.isNaN,Number.parseInt;class Z{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Q=()=>new Z,ee=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},te=e=>{const t=new Uint8Array(ee(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(z(e.cbuf.buffer,0,e.cpos),n),t},ne=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},re=ne,se=(e,t)=>{for(;t>Y;)ne(e,K|Y&t),t=u(t/128);ne(e,Y&t)},ie=(e,t)=>{const n=w(t);for(n&&(t=-t),ne(e,(t>63?K:0)|(n?q:0)|63&t),t=u(t/64);t>0;)ne(e,(t>Y?K:0)|Y&t),t=u(t/128)},oe=new Uint8Array(3e4),le=oe.length/3,ce=_&&_.encodeInto?(e,t)=>{if(t.length<le){const n=_.encodeInto(t,oe).written||0;se(e,n);for(let t=0;t<n;t++)ne(e,oe[t])}else he(e,k(t))}:(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;se(e,r);for(let t=0;t<r;t++)ne(e,n.codePointAt(t))},ae=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=f(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(g(2*n,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},he=(e,t)=>{se(e,t.byteLength),ae(e,t)},ue=(e,t)=>{((e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(z(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*g(n,t)),e.cpos=0)})(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},de=new DataView(new ArrayBuffer(4)),fe=(e,t)=>{switch(typeof t){case"string":ne(e,119),ce(e,t);break;case"number":G(t)&&d(t)<=2147483647?(ne(e,125),ie(e,t)):(n=t,de.setFloat32(0,n),de.getFloat32(0)===n?(ne(e,124),((e,t)=>{ue(e,4).setFloat32(0,t,!1)})(e,t)):(ne(e,123),((e,t)=>{ue(e,8).setFloat64(0,t,!1)})(e,t)));break;case"bigint":ne(e,122),((e,t)=>{ue(e,8).setBigInt64(0,t,!1)})(e,t);break;case"object":if(null===t)ne(e,126);else if(a(t)){ne(e,117),se(e,t.length);for(let n=0;n<t.length;n++)fe(e,t[n])}else if(t instanceof Uint8Array)ne(e,116),he(e,t);else{ne(e,118);const n=Object.keys(t);se(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];ce(e,s),fe(e,t[s])}}break;case"boolean":ne(e,t?120:121);break;default:ne(e,127)}var n};class ge extends Z{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&se(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const pe=e=>{e.count>0&&(ie(e.encoder,1===e.count?e.s:-e.s),e.count>1&&se(e.encoder,e.count-2))};class we{constructor(){this.encoder=new Z,this.s=0,this.count=0}write(e){this.s===e?this.count++:(pe(this),this.count=1,this.s=e)}toUint8Array(){return pe(this),te(this.encoder)}}const me=e=>{if(e.count>0){const t=2*e.diff+(1===e.count?0:1);ie(e.encoder,t),e.count>1&&se(e.encoder,e.count-2)}};class ye{constructor(){this.encoder=new Z,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(me(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return me(this),te(this.encoder)}}class be{constructor(){this.sarr=[],this.s="",this.lensE=new we}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new Z;return this.sarr.push(this.s),this.s="",ce(e,this.sarr.join("")),ae(e,this.lensE.toUint8Array()),te(e)}}const ve=e=>new Error(e),_e=()=>{throw ve("Method unimplemented")},ke=()=>{throw ve("Unexpected case")},Se=ve("Unexpected end of array"),Ee=ve("Integer out of Range");class Ce{constructor(e){this.arr=e,this.pos=0}}const De=e=>new Ce(e),xe=e=>((e,t)=>{const n=z(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n})(e,Ie(e)),Me=e=>e.arr[e.pos++],Ie=e=>{let t=0,n=1;const r=e.arr.length;for(;e.pos<r;){const r=e.arr[e.pos++];if(t+=(r&Y)*n,n*=128,r<K)return t;if(t>X)throw Ee}throw Se},Le=e=>{let t=e.arr[e.pos++],n=63&t,r=64;const s=(t&q)>0?-1:1;if(0==(t&K))return s*n;const i=e.arr.length;for(;e.pos<i;){if(t=e.arr[e.pos++],n+=(t&Y)*r,r*=128,t<K)return s*n;if(n>X)throw Ee}throw Se},Oe=S?e=>S.decode(xe(e)):e=>{let t=Ie(e);if(0===t)return"";{let n=String.fromCodePoint(Me(e));if(--t<100)for(;t--;)n+=String.fromCodePoint(Me(e));else for(;t>0;){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Ae=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Ne=[e=>{},e=>null,Le,e=>Ae(e,4).getFloat32(0,!1),e=>Ae(e,8).getFloat64(0,!1),e=>Ae(e,8).getBigInt64(0,!1),e=>!1,e=>!0,Oe,e=>{const t=Ie(e),n={};for(let r=0;r<t;r++)n[Oe(e)]=Pe(e);return n},e=>{const t=Ie(e),n=[];for(let r=0;r<t;r++)n.push(Pe(e));return n},xe],Pe=e=>Ne[127-Me(e)](e);class je extends Ce{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),(e=this).pos!==e.arr.length?this.count=Ie(this)+1:this.count=-1),this.count--,this.s;var e}}class Ue extends Ce{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=Le(this);const e=w(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ie(this)+2)}return this.count--,this.s}}class Te extends Ce{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const e=Le(this),t=1&e;this.diff=u(e/2),this.count=1,t&&(this.count=Ie(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Re{constructor(e){this.decoder=new Ue(e),this.str=Oe(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}crypto.subtle;const Fe=crypto.getRandomValues.bind(crypto),Be=(Math.random,()=>Fe(new Uint32Array(1))[0]),He=[1e7]+-1e3+-4e3+-8e3+-1e11,$e=()=>He.replace(/[018]/g,(e=>(e^Be()&15>>e/4).toString(16))),We=e=>new Promise(e);Promise.all.bind(Promise);class ze{constructor(e,t){this.left=e,this.right=t}}const Je=(e,t)=>new ze(e,t),Ve="undefined"!=typeof document?document:{},qe=("undefined"!=typeof DOMParser&&new DOMParser,Ve.ELEMENT_NODE,Ve.TEXT_NODE,Ve.CDATA_SECTION_NODE,Ve.COMMENT_NODE,Ve.DOCUMENT_NODE,Ve.DOCUMENT_TYPE_NODE,Ve.DOCUMENT_FRAGMENT_NODE,Symbol),Ke=Date.now,Ye=qe(),Xe=qe(),Ge=qe(),Ze=qe(),Qe=qe(),et=qe(),tt=qe(),nt=qe(),rt=qe();Ke();const st={[Ye]:Je("font-weight","bold"),[Xe]:Je("font-weight","normal"),[Ge]:Je("color","blue"),[Qe]:Je("color","green"),[Ze]:Je("color","grey"),[et]:Je("color","red"),[tt]:Je("color","purple"),[nt]:Je("color","orange"),[rt]:Je("color","black")},it=$?t=>{const n=[],r=[],s=e();let i=[],o=0;for(;o<t.length;o++){const e=t[o],i=st[e];if(void 0!==i)s.set(i.left,i.right);else{if(e.constructor!==String&&e.constructor!==Number)break;{const t=((e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n})(s,((e,t)=>`${t}:${e};`)).join("");o>0||t.length>0?(n.push("%c"+e),r.push(t)):n.push(e)}}}for(o>0&&(i=r,i.unshift(n.join("")));o<t.length;o++){const e=t[o];e instanceof Symbol||i.push(e)}return i}:e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const s=e[r];s.constructor===String||s.constructor===Number?t.push(s):s.constructor===Object&&n.push(JSON.stringify(s))}return n},ot=i(),lt=e=>({[Symbol.iterator](){return this},next:e}),ct=(e,t)=>lt((()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}}));class at{constructor(e,t){this.clock=e,this.len=t}}class ht{constructor(){this.clients=new Map}}const ut=(e,t,n)=>t.clients.forEach(((t,r)=>{const s=e.doc.store.clients.get(r);for(let r=0;r<t.length;r++){const i=t[r];nn(e,s,i.clock,i.len,n)}})),dt=(e,t)=>{const n=e.clients.get(t.client);return void 0!==n&&null!==((e,t)=>{let n=0,r=e.length-1;for(;n<=r;){const s=u((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null})(n,t.clock)},ft=e=>{e.clients.forEach((e=>{let t,n;for(e.sort(((e,t)=>e.clock-t.clock)),t=1,n=1;t<e.length;t++){const r=e[n-1],s=e[t];r.clock+r.len>=s.clock?r.len=g(r.len,s.clock+s.len-r.clock):(n<t&&(e[n]=s),n++)}e.length=n}))},gt=(e,t,n,r)=>{s(e.clients,t,(()=>[])).push(new at(n,r))},pt=()=>new ht,wt=(e,t)=>{se(e.restEncoder,t.clients.size),c(t.clients.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{e.resetDsCurVal(),se(e.restEncoder,t);const r=n.length;se(e.restEncoder,r);for(let t=0;t<r;t++){const r=n[t];e.writeDsClock(r.clock),e.writeDsLen(r.len)}}))},mt=e=>{const t=new ht,n=Ie(e.restDecoder);for(let r=0;r<n;r++){e.resetDsCurVal();const n=Ie(e.restDecoder),r=Ie(e.restDecoder);if(r>0){const i=s(t.clients,n,(()=>[]));for(let t=0;t<r;t++)i.push(new at(e.readDsClock(),e.readDsLen()))}}return t},yt=(e,t,n)=>{const r=new ht,s=Ie(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const s=Ie(e.restDecoder),i=Ie(e.restDecoder),o=n.clients.get(s)||[],l=Yt(n,s);for(let n=0;n<i;n++){const n=e.readDsClock(),i=n+e.readDsLen();if(n<l){l<i&&gt(r,s,l,i-l);let e=Gt(o,n),c=o[e];for(!c.deleted&&c.id.clock<n&&(o.splice(e+1,0,Rr(t,c,n-c.id.clock)),e++);e<o.length&&(c=o[e++],c.id.clock<i);)c.deleted||(i<c.id.clock+c.length&&o.splice(e,0,Rr(t,c,i-c.id.clock)),c.delete(t))}else gt(r,s,n,i-n)}}if(r.clients.size>0){const e=new Mt;return se(e.restEncoder,0),wt(e,r),e.toUint8Array()}return null},bt=Be;class vt extends h{constructor({guid:e=$e(),collectionid:t=null,gc:n=!0,gcFilter:r=(()=>!0),meta:s=null,autoLoad:i=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=bt(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new qt,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=We((e=>{this.on("load",(()=>{this.isLoaded=!0,e(this)}))}));const l=()=>We((e=>{const t=n=>{void 0!==n&&!0!==n||(this.off("sync",t),e())};this.on("sync",t)}));this.on("sync",(e=>{!1===e&&this.isSynced&&(this.whenSynced=l()),this.isSynced=void 0===e||!0===e,this.isLoaded||this.emit("load",[])})),this.whenSynced=l()}load(){const e=this._item;null===e||this.shouldLoad||an(e.parent.doc,(e=>{e.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(c(this.subdocs).map((e=>e.guid)))}transact(e,t=null){return an(this,e,t)}get(e,t=In){const n=s(this.share,e,(()=>{const e=new t;return e._integrate(this,null),e})),r=n.constructor;if(t!==In&&r!==t){if(r===In){const r=new t;r._map=n._map,n._map.forEach((e=>{for(;null!==e;e=e.left)e.parent=r})),r._start=n._start;for(let e=r._start;null!==e;e=e.right)e.parent=r;return r._length=n._length,this.share.set(e,r),r._integrate(this,null),r}throw new Error(`Type with the name ${e} has already been defined with a different constructor`)}return n}getArray(e=""){return this.get(e,qn)}getText(e=""){return this.get(e,ur)}getMap(e=""){return this.get(e,Yn)}getXmlFragment(e=""){return this.get(e,fr)}toJSON(){const e={};return this.share.forEach(((t,n)=>{e[n]=t.toJSON()})),e}destroy(){c(this.subdocs).forEach((e=>e.destroy()));const e=this._item;if(null!==e){this._item=null;const t=e.content;t.doc=new vt({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,an(e.parent.doc,(n=>{const r=t.doc;e.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class _t{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ie(this.restDecoder)}readDsLen(){return Ie(this.restDecoder)}}class kt extends _t{readLeftID(){return Ht(Ie(this.restDecoder),Ie(this.restDecoder))}readRightID(){return Ht(Ie(this.restDecoder),Ie(this.restDecoder))}readClient(){return Ie(this.restDecoder)}readInfo(){return Me(this.restDecoder)}readString(){return Oe(this.restDecoder)}readParentInfo(){return 1===Ie(this.restDecoder)}readTypeRef(){return Ie(this.restDecoder)}readLen(){return Ie(this.restDecoder)}readAny(){return Pe(this.restDecoder)}readBuf(){return(e=>{const t=W(e.byteLength);return t.set(e),t})(xe(this.restDecoder))}readJSON(){return JSON.parse(Oe(this.restDecoder))}readKey(){return Oe(this.restDecoder)}}class St{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ie(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ie(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Et extends St{constructor(e){super(e),this.keys=[],Ie(e),this.keyClockDecoder=new Te(xe(e)),this.clientDecoder=new Ue(xe(e)),this.leftClockDecoder=new Te(xe(e)),this.rightClockDecoder=new Te(xe(e)),this.infoDecoder=new je(xe(e),Me),this.stringDecoder=new Re(xe(e)),this.parentInfoDecoder=new je(xe(e),Me),this.typeRefDecoder=new Ue(xe(e)),this.lenDecoder=new Ue(xe(e))}readLeftID(){return new Ft(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Ft(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Pe(this.restDecoder)}readBuf(){return xe(this.restDecoder)}readJSON(){return Pe(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Ct{constructor(){this.restEncoder=Q()}toUint8Array(){return te(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){se(this.restEncoder,e)}writeDsLen(e){se(this.restEncoder,e)}}class Dt extends Ct{writeLeftID(e){se(this.restEncoder,e.client),se(this.restEncoder,e.clock)}writeRightID(e){se(this.restEncoder,e.client),se(this.restEncoder,e.clock)}writeClient(e){se(this.restEncoder,e)}writeInfo(e){re(this.restEncoder,e)}writeString(e){ce(this.restEncoder,e)}writeParentInfo(e){se(this.restEncoder,e?1:0)}writeTypeRef(e){se(this.restEncoder,e)}writeLen(e){se(this.restEncoder,e)}writeAny(e){fe(this.restEncoder,e)}writeBuf(e){he(this.restEncoder,e)}writeJSON(e){ce(this.restEncoder,JSON.stringify(e))}writeKey(e){ce(this.restEncoder,e)}}class xt{constructor(){this.restEncoder=Q(),this.dsCurrVal=0}toUint8Array(){return te(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,se(this.restEncoder,t)}writeDsLen(e){0===e&&ke(),se(this.restEncoder,e-1),this.dsCurrVal+=e}}class Mt extends xt{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ye,this.clientEncoder=new we,this.leftClockEncoder=new ye,this.rightClockEncoder=new ye,this.infoEncoder=new ge(re),this.stringEncoder=new be,this.parentInfoEncoder=new ge(re),this.typeRefEncoder=new we,this.lenEncoder=new we}toUint8Array(){const e=Q();return se(e,0),he(e,this.keyClockEncoder.toUint8Array()),he(e,this.clientEncoder.toUint8Array()),he(e,this.leftClockEncoder.toUint8Array()),he(e,this.rightClockEncoder.toUint8Array()),he(e,te(this.infoEncoder)),he(e,this.stringEncoder.toUint8Array()),he(e,te(this.parentInfoEncoder)),he(e,this.typeRefEncoder.toUint8Array()),he(e,this.lenEncoder.toUint8Array()),ae(e,te(this.restEncoder)),te(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){fe(this.restEncoder,e)}writeBuf(e){he(this.restEncoder,e)}writeJSON(e){fe(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const It=(e,t,n)=>{const r=new Map;n.forEach(((e,n)=>{Yt(t,n)>e&&r.set(n,e)})),Kt(t).forEach(((e,t)=>{n.has(t)||r.set(t,0)})),se(e.restEncoder,r.size),c(r.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([n,r])=>{((e,t,n,r)=>{r=g(r,t[0].id.clock);const s=Gt(t,r);se(e.restEncoder,t.length-s),e.writeClient(n),se(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let n=s+1;n<t.length;n++)t[n].write(e,0)})(e,t.clients.get(n),n,r)}))},Lt=(t,n,r,i=Et)=>{const o=De(n);((t,n,r,i=new Et(t))=>{an(n,(t=>{t.local=!1;let n=!1;const r=t.doc,o=r.store,l=((t,n)=>{const r=e(),s=Ie(t.restDecoder);for(let e=0;e<s;e++){const e=Ie(t.restDecoder),s=new Array(e),i=t.readClient();let o=Ie(t.restDecoder);r.set(i,{i:0,refs:s});for(let r=0;r<e;r++){const e=t.readInfo();switch(31&e){case 0:{const e=t.readLen();s[r]=new br(Ht(i,o),e),o+=e;break}case 10:{const e=Ie(t.restDecoder);s[r]=new $r(Ht(i,o),e),o+=e;break}default:{const l=0==(192&e),c=new Fr(Ht(i,o),null,(e&K)===K?t.readLeftID():null,null,(e&q)===q?t.readRightID():null,l?t.readParentInfo()?n.get(t.readString()):t.readLeftID():null,l&&32==(32&e)?t.readString():null,Br(t,e));s[r]=c,o+=c.length}}}}return r})(i,r),a=((e,t,n)=>{const r=[];let i=c(n.keys()).sort(((e,t)=>e-t));if(0===i.length)return null;const o=()=>{if(0===i.length)return null;let e=n.get(i[i.length-1]);for(;e.refs.length===e.i;){if(i.pop(),!(i.length>0))return null;e=n.get(i[i.length-1])}return e};let l=o();if(null===l&&0===r.length)return null;const a=new qt,h=new Map,u=(e,t)=>{const n=h.get(e);(null==n||n>t)&&h.set(e,t)};let d=l.refs[l.i++];const f=new Map,g=()=>{for(const e of r){const t=e.id.client,r=n.get(t);r?(r.i--,a.clients.set(t,r.refs.slice(r.i)),n.delete(t),r.i=0,r.refs=[]):a.clients.set(t,[e]),i=i.filter((e=>e!==t))}r.length=0};for(;;){if(d.constructor!==$r){const i=s(f,d.id.client,(()=>Yt(t,d.id.client)))-d.id.clock;if(i<0)r.push(d),u(d.id.client,d.id.clock-1),g();else{const s=d.getMissing(e,t);if(null!==s){r.push(d);const e=n.get(s)||{refs:[],i:0};if(e.refs.length!==e.i){d=e.refs[e.i++];continue}u(s,Yt(t,s)),g()}else(0===i||i<d.length)&&(d.integrate(e,i),f.set(d.id.client,d.id.clock+d.length))}}if(r.length>0)d=r.pop();else if(null!==l&&l.i<l.refs.length)d=l.refs[l.i++];else{if(l=o(),null===l)break;d=l.refs[l.i++]}}if(a.clients.size>0){const e=new Mt;return It(e,a,new Map),se(e.restEncoder,0),{missing:h,update:e.toUint8Array()}}return null})(t,o,l),h=o.pendingStructs;if(h){for(const[e,t]of h.missing)if(t<Yt(o,e)){n=!0;break}if(a){for(const[e,t]of a.missing){const n=h.missing.get(e);(null==n||n>t)&&h.missing.set(e,t)}h.update=gn([h.update,a.update])}}else o.pendingStructs=a;const u=yt(i,t,o);if(o.pendingDs){const e=new Et(De(o.pendingDs));Ie(e.restDecoder);const n=yt(e,t,o);o.pendingDs=u&&n?gn([u,n]):u||n}else o.pendingDs=u;if(n){const e=o.pendingStructs.update;o.pendingStructs=null,Lt(t.doc,e)}}),r,!1)})(o,t,r,new i(o))},Ot=(e,t=new Uint8Array([0]),n=new Mt)=>{((e,t,n=new Map)=>{It(e,t.store,n),wt(e,(e=>{const t=pt();return e.clients.forEach(((e,n)=>{const r=[];for(let t=0;t<e.length;t++){const n=e[t];if(n.deleted){const s=n.id.clock;let i=n.length;if(t+1<e.length)for(let n=e[t+1];t+1<e.length&&n.deleted;n=e[1+ ++t])i+=n.length;r.push(new at(s,i))}}r.length>0&&t.clients.set(n,r)})),t})(t.store))})(n,e,At(t));const r=[n.toUint8Array()];if(e.store.pendingDs&&r.push(e.store.pendingDs),e.store.pendingStructs&&r.push(pn(e.store.pendingStructs.update,t)),r.length>1){if(n.constructor===Dt)return dn(r.map(((e,t)=>0===t?e:bn(e))));if(n.constructor===Mt)return gn(r)}return r[0]},At=e=>(e=>{const t=new Map,n=Ie(e.restDecoder);for(let r=0;r<n;r++){const n=Ie(e.restDecoder),r=Ie(e.restDecoder);t.set(n,r)}return t})(new _t(De(e))),Nt=(e,t)=>(se(e.restEncoder,t.size),c(t.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{se(e.restEncoder,t),se(e.restEncoder,n)})),e);class Pt{constructor(){this.l=[]}}const jt=()=>new Pt,Ut=(e,t)=>e.l.push(t),Tt=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter((e=>t!==e)),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Rt=(e,t,n)=>O(e.l,[t,n]);class Ft{constructor(e,t){this.client=e,this.clock=t}}const Bt=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,Ht=(e,t)=>new Ft(e,t);class $t{constructor(e,t){this.ds=e,this.sv=t}}const Wt=(Jt=pt(),Vt=new Map,new $t(Jt,Vt),(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!dt(t.ds,e.id)),zt=(e,t)=>{const n=s(e.meta,zt,i),r=e.doc.store;n.has(t)||(t.sv.forEach(((t,n)=>{t<Yt(r,n)&&en(e,Ht(n,t))})),ut(e,t.ds,(e=>{})),n.add(t))};var Jt,Vt;class qt{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Kt=e=>{const t=new Map;return e.clients.forEach(((e,n)=>{const r=e[e.length-1];t.set(n,r.id.clock+r.length)})),t},Yt=(e,t)=>{const n=e.clients.get(t);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},Xt=(e,t)=>{let n=e.clients.get(t.id.client);if(void 0===n)n=[],e.clients.set(t.id.client,n);else{const e=n[n.length-1];if(e.id.clock+e.length!==t.id.clock)throw ke()}n.push(t)},Gt=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=u(t/(i+s.length-1)*r);for(;n<=r;){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=u((n+r)/2)}throw ke()},Zt=(e,t)=>{const n=e.clients.get(t.client);return n[Gt(n,t.clock)]},Qt=(e,t,n)=>{const r=Gt(t,n),s=t[r];return s.id.clock<n&&s instanceof Fr?(t.splice(r+1,0,Rr(e,s,n-s.id.clock)),r+1):r},en=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[Qt(e,n,t.clock)]},tn=(e,t,n)=>{const r=t.clients.get(n.client),s=Gt(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==br&&r.splice(s+1,0,Rr(e,i,n.clock-i.id.clock+1)),i},nn=(e,t,n,r,s)=>{if(0===r)return;const i=n+r;let o,l=Qt(e,t,n);do{o=t[l++],i<o.id.clock+o.length&&Qt(e,t,i),s(o)}while(l<t.length&&t[l].id.clock<i)};class rn{constructor(e,t,n){this.doc=e,this.deleteSet=new ht,this.beforeState=Kt(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const sn=(e,t)=>!(0===t.deleteSet.clients.size&&!((e,n)=>{for(const[n,i]of e)if(r=i,s=n,t.beforeState.get(s)!==r)return!0;var r,s;return!1})(t.afterState)||(ft(t.deleteSet),((e,t)=>{It(e,t.doc.store,t.beforeState)})(e,t),wt(e,t.deleteSet),0)),on=(e,t,n)=>{const r=t._item;(null===r||r.id.clock<(e.beforeState.get(r.id.client)||0)&&!r.deleted)&&s(e.changed,t,i).add(n)},ln=(e,t)=>{let n=e[t],r=e[t-1],s=t;for(;s>0&&r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n);n=r,r=e[--s-1])n instanceof Fr&&null!==n.parentSub&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);const i=t-s;return i&&e.splice(t+1-i,i),i},cn=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{ft(i),n.afterState=Kt(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const e=[];n.changed.forEach(((t,r)=>e.push((()=>{null!==r._item&&r._item.deleted||r._callObserver(n,t)})))),e.push((()=>{n.changedParentTypes.forEach(((e,t)=>{t._dEH.l.length>0&&(null===t._item||!t._item.deleted)&&((e=e.filter((e=>null===e.target._item||!e.target._item.deleted))).forEach((e=>{e.currentTarget=t,e._path=null})),e.sort(((e,t)=>e.path.length-t.path.length)),Rt(t._dEH,e,n))}))})),e.push((()=>r.emit("afterTransaction",[n,r]))),O(e,[]),n._needFormattingCleanup&&cr(n)}finally{r.gc&&((e,t,n)=>{for(const[r,s]of e.clients.entries()){const e=t.clients.get(r);for(let r=s.length-1;r>=0;r--){const i=s[r],o=i.clock+i.len;for(let r=Gt(e,i.clock),s=e[r];r<e.length&&s.id.clock<o;s=e[++r]){const s=e[r];if(i.clock+i.len<=s.id.clock)break;s instanceof Fr&&s.deleted&&!s.keep&&n(s)&&s.gc(t,!1)}}}})(i,s,r.gcFilter),((e,t)=>{e.clients.forEach(((e,n)=>{const r=t.clients.get(n);for(let t=e.length-1;t>=0;t--){const n=e[t];for(let e=f(r.length-1,1+Gt(r,n.clock+n.len-1)),t=r[e];e>0&&t.id.clock>=n.clock;t=r[e])e-=1+ln(r,e)}}))})(i,s),n.afterState.forEach(((e,t)=>{const r=n.beforeState.get(t)||0;if(r!==e){const e=s.clients.get(t),n=g(Gt(e,r),1);for(let t=e.length-1;t>=n;)t-=1+ln(e,t)}}));for(let e=o.length-1;e>=0;e--){const{client:t,clock:n}=o[e].id,r=s.clients.get(t),i=Gt(r,n);i+1<r.length&&ln(r,i+1)>1||i>0&&ln(r,i)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(((...e)=>{console.log(...it(e)),ot.forEach((t=>t.print(e)))})(nt,Ye,"[yjs] ",Xe,et,"Changed the client-id because another client seems to be using it."),r.clientID=bt()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const e=new Dt;sn(e,n)&&r.emit("update",[e.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const e=new Mt;sn(e,n)&&r.emit("updateV2",[e.toUint8Array(),n.origin,r,n])}const{subdocsAdded:l,subdocsLoaded:c,subdocsRemoved:a}=n;(l.size>0||a.size>0||c.size>0)&&(l.forEach((e=>{e.clientID=r.clientID,null==e.collectionid&&(e.collectionid=r.collectionid),r.subdocs.add(e)})),a.forEach((e=>r.subdocs.delete(e))),r.emit("subdocs",[{loaded:c,added:l,removed:a},r,n]),a.forEach((e=>e.destroy()))),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):cn(e,t+1)}}},an=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;null===e._transaction&&(i=!0,e._transaction=new rn(e,n,r),s.push(e._transaction),1===s.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const t=e._transaction===s[0];e._transaction=null,t&&cn(s,0)}}return o};class hn{constructor(e,t){this.gen=function*(e){const t=Ie(e.restDecoder);for(let n=0;n<t;n++){const t=Ie(e.restDecoder),n=e.readClient();let r=Ie(e.restDecoder);for(let s=0;s<t;s++){const t=e.readInfo();if(10===t){const t=Ie(e.restDecoder);yield new $r(Ht(n,r),t),r+=t}else if(0!=(31&t)){const s=0==(192&t),i=new Fr(Ht(n,r),null,(t&K)===K?e.readLeftID():null,null,(t&q)===q?e.readRightID():null,s?e.readParentInfo()?e.readString():e.readLeftID():null,s&&32==(32&t)?e.readString():null,Br(e,t));yield i,r+=i.length}else{const t=e.readLen();yield new br(Ht(n,r),t),r+=t}}}}(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===$r);return this.curr}}class un{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const dn=e=>gn(e,kt,Dt),fn=(e,t)=>{if(e.constructor===br){const{client:n,clock:r}=e.id;return new br(Ht(n,r+t),e.length-t)}if(e.constructor===$r){const{client:n,clock:r}=e.id;return new $r(Ht(n,r+t),e.length-t)}{const n=e,{client:r,clock:s}=n.id;return new Fr(Ht(r,s+t),null,Ht(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},gn=(e,t=Et,n=Mt)=>{if(1===e.length)return e[0];const r=e.map((e=>new t(De(e))));let s=r.map((e=>new hn(e,!0))),i=null;const o=new n,c=new un(o);for(;s=s.filter((e=>null!==e.curr)),s.sort(((e,t)=>{if(e.curr.id.client===t.curr.id.client){const n=e.curr.id.clock-t.curr.id.clock;return 0===n?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===$r?1:-1:n}return t.curr.id.client-e.curr.id.client})),0!==s.length;){const e=s[0],t=e.curr.id.client;if(null!==i){let n=e.curr,r=!1;for(;null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client;)n=e.next(),r=!0;if(null===n||n.id.client!==t||r&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(t!==i.struct.id.client)mn(c,i.struct,i.offset),i={struct:n,offset:0},e.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===$r)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{mn(c,i.struct,i.offset);const e=n.id.clock-i.struct.id.clock-i.struct.length;i={struct:new $r(Ht(t,i.struct.id.clock+i.struct.length),e),offset:0}}else{const t=i.struct.id.clock+i.struct.length-n.id.clock;t>0&&(i.struct.constructor===$r?i.struct.length-=t:n=fn(n,t)),i.struct.mergeWith(n)||(mn(c,i.struct,i.offset),i={struct:n,offset:0},e.next())}}else i={struct:e.curr,offset:0},e.next();for(let n=e.curr;null!==n&&n.id.client===t&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==$r;n=e.next())mn(c,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(mn(c,i.struct,i.offset),i=null),yn(c);const a=(e=>{const t=new ht;for(let n=0;n<e.length;n++)e[n].clients.forEach(((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let t=n+1;t<e.length;t++)l(i,e[t].clients.get(s)||[]);t.clients.set(s,i)}}));return ft(t),t})(r.map((e=>mt(e))));return wt(o,a),o.toUint8Array()},pn=(e,t,n=Et,r=Mt)=>{const s=At(t),i=new r,o=new un(i),l=new n(De(e)),c=new hn(l,!1);for(;c.curr;){const e=c.curr,t=e.id.client,n=s.get(t)||0;if(c.curr.constructor!==$r)if(e.id.clock+e.length>n)for(mn(o,e,g(n-e.id.clock,0)),c.next();c.curr&&c.curr.id.client===t;)mn(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===t&&c.curr.id.clock+c.curr.length<=n;)c.next();else c.next()}yn(o);const a=mt(l);return wt(i,a),i.toUint8Array()},wn=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:te(e.encoder.restEncoder)}),e.encoder.restEncoder=Q(),e.written=0)},mn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&wn(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),se(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},yn=e=>{wn(e);const t=e.encoder.restEncoder;se(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];se(t,r.written),ae(t,r.restEncoder)}},bn=e=>((e,t,n,r)=>{const s=new n(De(e)),i=new hn(s,!1),o=new r,l=new un(o);for(let e=i.curr;null!==e;e=i.next())mn(l,t(e),0);yn(l);const c=mt(s);return wt(o,c),o.toUint8Array()})(e,A,Et,Dt),vn="You must not compute changes after the event-handler fired.";class _n{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=kn(this.currentTarget,this.target))}deletes(e){return dt(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw ve(vn);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach((n=>{if(null!==n){const r=t._map.get(n);let s,i;if(this.adds(r)){let e=r.left;for(;null!==e&&this.adds(e);)e=e.left;if(this.deletes(r)){if(null===e||!this.deletes(e))return;s="delete",i=o(e.content.getContent())}else null!==e&&this.deletes(e)?(s="update",i=o(e.content.getContent())):(s="add",i=void 0)}else{if(!this.deletes(r))return;s="delete",i=o(r.content.getContent())}e.set(n,{action:s,oldValue:i})}})),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){if(0===this.transaction.doc._transactionCleanups.length)throw ve(vn);const t=this.target,n=i(),r=i(),s=[];if(e={added:n,deleted:r,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let e=null;const i=()=>{e&&s.push(e)};for(let s=t._start;null!==s;s=s.right)s.deleted?this.deletes(s)&&!this.adds(s)&&(null!==e&&void 0!==e.delete||(i(),e={delete:0}),e.delete+=s.length,r.add(s)):this.adds(s)?(null!==e&&void 0!==e.insert||(i(),e={insert:[]}),e.insert=e.insert.concat(s.content.getContent()),n.add(s)):(null!==e&&void 0!==e.retain||(i(),e={retain:0}),e.retain+=s.length);null!==e&&void 0===e.retain&&i()}this._changes=e}return e}}const kn=(e,t)=>{const n=[];for(;null!==t._item&&t!==e;){if(null!==t._item.parentSub)n.unshift(t._item.parentSub);else{let e=0,r=t._item.parent._start;for(;r!==t._item&&null!==r;)r.deleted||e++,r=r.right;n.unshift(e)}t=t._item.parent}return n};let Sn=0;class En{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Sn++}}const Cn=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=Sn++},Dn=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;const n=0===e._searchMarker.length?null:e._searchMarker.reduce(((e,n)=>d(t-e.index)<d(t-n.index)?e:n));let r=e._start,s=0;for(null!==n&&(r=n.p,s=n.index,(e=>{e.timestamp=Sn++})(n));null!==r.right&&s<t;){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}for(;null!==r.left&&s>t;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return null!==n&&d(n.index-s)<r.parent.length/80?(Cn(n,r,s),n):((e,t,n)=>{if(e.length>=80){const r=e.reduce(((e,t)=>e.timestamp<t.timestamp?e:t));return Cn(r,t,n),r}{const r=new En(t,n);return e.push(r),r}})(e._searchMarker,r,s)},xn=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let t=s.p;for(t.marker=!1;t&&(t.deleted||!t.countable);)t=t.left,t&&!t.deleted&&t.countable&&(s.index-=t.length);if(null===t||!0===t.marker){e.splice(r,1);continue}s.p=t,t.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=g(t,s.index+n))}},Mn=(e,t,n)=>{const r=e,i=t.changedParentTypes;for(;s(i,e,(()=>[])).push(n),null!==e._item;)e=e._item.parent;Rt(r._eH,n,t)};class In{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=jt(),this._dEH=jt(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw _e()}clone(){throw _e()}_write(e){}get _first(){let e=this._start;for(;null!==e&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Ut(this._eH,e)}observeDeep(e){Ut(this._dEH,e)}unobserve(e){Tt(this._eH,e)}unobserveDeep(e){Tt(this._dEH,e)}toJSON(){}}const Ln=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;for(;null!==i&&r>0;){if(i.countable&&!i.deleted){const e=i.content.getContent();if(e.length<=t)t-=e.length;else{for(let n=t;n<e.length&&r>0;n++)s.push(e[n]),r--;t=0}}i=i.right}return s},On=e=>{const t=[];let n=e._start;for(;null!==n;){if(n.countable&&!n.deleted){const e=n.content.getContent();for(let n=0;n<e.length;n++)t.push(e[n])}n=n.right}return t},An=(e,t)=>{let n=0,r=e._start;for(;null!==r;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let r=0;r<s.length;r++)t(s[r],n++,e)}r=r.right}},Nn=(e,t)=>{const n=[];return An(e,((r,s)=>{n.push(t(r,s,e))})),n},Pn=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==t&&t.deleted;)t=t.right;if(null===t)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const e=n[r++];return n.length<=r&&(n=null),{done:!1,value:e}}}},jn=(e,t)=>{const n=Dn(e,t);let r=e._start;for(null!==n&&(r=n.p,t-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},Un=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,l=i.store,c=null===n?t._start:n.right;let a=[];const h=()=>{a.length>0&&(s=new Fr(Ht(o,Yt(l,o)),s,s&&s.lastId,c,c&&c.id,t,null,new xr(a)),s.integrate(e,0),a=[])};r.forEach((n=>{if(null===n)a.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:a.push(n);break;default:switch(h(),n.constructor){case Uint8Array:case ArrayBuffer:s=new Fr(Ht(o,Yt(l,o)),s,s&&s.lastId,c,c&&c.id,t,null,new vr(new Uint8Array(n))),s.integrate(e,0);break;case vt:s=new Fr(Ht(o,Yt(l,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Sr(n)),s.integrate(e,0);break;default:if(!(n instanceof In))throw new Error("Unexpected content type in insert operation");s=new Fr(Ht(o,Yt(l,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Tr(n)),s.integrate(e,0)}}})),h()},Tn=ve("Length exceeded!"),Rn=(e,t,n,r)=>{if(n>t._length)throw Tn;if(0===n)return t._searchMarker&&xn(t._searchMarker,n,r.length),Un(e,t,null,r);const s=n,i=Dn(t,n);let o=t._start;for(null!==i&&(o=i.p,0==(n-=i.index)&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&en(e,Ht(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&xn(t._searchMarker,s,r.length),Un(e,t,o,r)},Fn=(e,t,n,r)=>{if(0===r)return;const s=n,i=r,o=Dn(t,n);let l=t._start;for(null!==o&&(l=o.p,n-=o.index);null!==l&&n>0;l=l.right)!l.deleted&&l.countable&&(n<l.length&&en(e,Ht(l.id.client,l.id.clock+n)),n-=l.length);for(;r>0&&null!==l;)l.deleted||(r<l.length&&en(e,Ht(l.id.client,l.id.clock+r)),l.delete(e),r-=l.length),l=l.right;if(r>0)throw Tn;t._searchMarker&&xn(t._searchMarker,s,-i+r)},Bn=(e,t,n)=>{const r=t._map.get(n);void 0!==r&&r.delete(e)},Hn=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let l;if(null==r)l=new xr([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:l=new xr([r]);break;case Uint8Array:l=new vr(r);break;case vt:l=new Sr(r);break;default:if(!(r instanceof In))throw new Error("Unexpected content type");l=new Tr(r)}new Fr(Ht(o,Yt(i.store,o)),s,s&&s.lastId,null,null,t,n,l).integrate(e,0)},$n=(e,t)=>{const n=e._map.get(t);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Wn=e=>{const t={};return e._map.forEach(((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])})),t},zn=(e,t)=>{const n=e._map.get(t);return void 0!==n&&!n.deleted},Jn=e=>{return t=e.entries(),n=e=>!e[1].deleted,lt((()=>{let e;do{e=t.next()}while(!e.done&&!n(e.value));return e}));var t,n};class Vn extends _n{constructor(e,t){super(e,t),this._transaction=t}}class qn extends In{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new qn;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new qn}clone(){const e=new qn;return e.insert(0,this.toArray().map((e=>e instanceof In?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),Mn(this,e,new Vn(this,e))}insert(e,t){null!==this.doc?an(this.doc,(n=>{Rn(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?an(this.doc,(t=>{((e,t,n)=>{let r=(t._searchMarker||[]).reduce(((e,t)=>t.index>e.index?t:e),{index:0,p:t._start}).p;if(r)for(;r.right;)r=r.right;Un(e,t,r,n)})(t,this,e)})):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?an(this.doc,(n=>{Fn(n,this,e,t)})):this._prelimContent.splice(e,t)}get(e){return jn(this,e)}toArray(){return On(this)}slice(e=0,t=this.length){return Ln(this,e,t)}toJSON(){return this.map((e=>e instanceof In?e.toJSON():e))}map(e){return Nn(this,e)}forEach(e){An(this,e)}[Symbol.iterator](){return Pn(this)}_write(e){e.writeTypeRef(Lr)}}class Kn extends _n{constructor(e,t,n){super(e,t),this.keysChanged=n}}class Yn extends In{constructor(e){super(),this._prelimContent=null,this._prelimContent=void 0===e?new Map:new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach(((e,t)=>{this.set(t,e)})),this._prelimContent=null}_copy(){return new Yn}clone(){const e=new Yn;return this.forEach(((t,n)=>{e.set(n,t instanceof In?t.clone():t)})),e}_callObserver(e,t){Mn(this,e,new Kn(this,e,t))}toJSON(){const e={};return this._map.forEach(((t,n)=>{if(!t.deleted){const r=t.content.getContent()[t.length-1];e[n]=r instanceof In?r.toJSON():r}})),e}get size(){return[...Jn(this._map)].length}keys(){return ct(Jn(this._map),(e=>e[0]))}values(){return ct(Jn(this._map),(e=>e[1].content.getContent()[e[1].length-1]))}entries(){return ct(Jn(this._map),(e=>[e[0],e[1].content.getContent()[e[1].length-1]]))}forEach(e){this._map.forEach(((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?an(this.doc,(t=>{Bn(t,this,e)})):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?an(this.doc,(n=>{Hn(n,this,e,t)})):this._prelimContent.set(e,t),t}get(e){return $n(this,e)}has(e){return zn(this,e)}clear(){null!==this.doc?an(this.doc,(e=>{this.forEach((function(t,n,r){Bn(e,r,n)}))})):this._prelimContent.clear()}_write(e){e.writeTypeRef(Or)}}const Xn=(e,t)=>e===t||"object"==typeof e&&"object"==typeof t&&e&&t&&((e,t)=>e===t||I(e)===I(t)&&((e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0})(e,((e,n)=>(void 0!==e||L(t,n))&&t[n]===e)))(e,t);class Gn{constructor(e,t,n,r){this.left=e,this.right=t,this.index=n,this.currentAttributes=r}forward(){null===this.right&&ke(),this.right.content.constructor===Cr?this.right.deleted||tr(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}const Zn=(e,t,n)=>{for(;null!==t.right&&n>0;)t.right.content.constructor===Cr?t.right.deleted||tr(t.currentAttributes,t.right.content):t.right.deleted||(n<t.right.length&&en(e,Ht(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length),t.left=t.right,t.right=t.right.right;return t},Qn=(e,t,n)=>{const r=new Map,s=Dn(t,n);if(s){const t=new Gn(s.p.left,s.p,s.index,r);return Zn(e,t,n-s.index)}{const s=new Gn(null,t._start,0,r);return Zn(e,s,n)}},er=(e,t,n,r)=>{for(;null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===Cr&&Xn(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach(((r,o)=>{const l=n.left,c=n.right,a=new Fr(Ht(i,Yt(s.store,i)),l,l&&l.lastId,c,c&&c.id,t,null,new Cr(o,r));a.integrate(e,0),n.right=a,n.forward()}))},tr=(e,t)=>{const{key:n,value:r}=t;null===r?e.delete(n):e.set(n,r)},nr=(e,t)=>{for(;null!==e.right&&(e.right.deleted||e.right.content.constructor===Cr&&Xn(t[e.right.content.key]||null,e.right.content.value));)e.forward()},rr=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const l in r){const c=r[l],a=n.currentAttributes.get(l)||null;if(!Xn(a,c)){o.set(l,a);const{left:r,right:h}=n;n.right=new Fr(Ht(i,Yt(s.store,i)),r,r&&r.lastId,h,h&&h.id,t,null,new Cr(l,c)),n.right.integrate(e,0),n.forward()}}return o},sr=(e,t,n,r,s)=>{n.currentAttributes.forEach(((e,t)=>{void 0===s[t]&&(s[t]=null)}));const i=e.doc,o=i.clientID;nr(n,s);const l=rr(e,t,n,s),c=r.constructor===String?new Mr(r):r instanceof In?new Tr(r):new Er(r);let{left:a,right:h,index:u}=n;t._searchMarker&&xn(t._searchMarker,n.index,c.getLength()),h=new Fr(Ht(o,Yt(i.store,o)),a,a&&a.lastId,h,h&&h.id,t,null,c),h.integrate(e,0),n.right=h,n.index=u,n.forward(),er(e,t,n,l)},ir=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;nr(n,s);const l=rr(e,t,n,s);e:for(;null!==n.right&&(r>0||l.size>0&&(n.right.deleted||n.right.content.constructor===Cr));){if(!n.right.deleted)switch(n.right.content.constructor){case Cr:{const{key:t,value:i}=n.right.content,o=s[t];if(void 0!==o){if(Xn(o,i))l.delete(t);else{if(0===r)break e;l.set(t,i)}n.right.delete(e)}else n.currentAttributes.set(t,i);break}default:r<n.right.length&&en(e,Ht(n.right.id.client,n.right.id.clock+r)),r-=n.right.length}n.forward()}if(r>0){let s="";for(;r>0;r--)s+="\n";n.right=new Fr(Ht(o,Yt(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Mr(s)),n.right.integrate(e,0),n.forward()}er(e,t,n,l)},or=(t,n,r,s,i)=>{let o=n;const l=e();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===Cr){const e=o.content;l.set(e.key,e)}o=o.right}let c=0,a=!1;for(;n!==o;){if(r===n&&(a=!0),!n.deleted){const e=n.content;switch(e.constructor){case Cr:{const{key:r,value:o}=e,h=s.get(r)||null;l.get(r)===e&&h!==o||(n.delete(t),c++,a||(i.get(r)||null)!==o||h===o||(null===h?i.delete(r):i.set(r,h))),a||n.deleted||tr(i,e);break}}}n=n.right}return c},lr=n=>{let r=0;return an(n.doc,(s=>{let i=n._start,o=n._start,l=e();const c=t(l);for(;o;)!1===o.deleted&&(o.content.constructor===Cr?tr(c,o.content):(r+=or(s,i,o,l,c),l=t(c),i=o)),o=o.right})),r},cr=e=>{const t=new Set,n=e.doc;for(const[r,s]of e.afterState.entries()){const i=e.beforeState.get(r)||0;s!==i&&nn(e,n.store.clients.get(r),i,s,(e=>{e.deleted||e.content.constructor!==Cr||e.constructor===br||t.add(e.parent)}))}an(n,(n=>{ut(e,e.deleteSet,(e=>{if(e instanceof br||!e.parent._hasFormatting||t.has(e.parent))return;const r=e.parent;e.content.constructor===Cr?t.add(r):((e,t)=>{for(;t&&t.right&&(t.right.deleted||!t.right.countable);)t=t.right;const n=new Set;for(;t&&(t.deleted||!t.countable);){if(!t.deleted&&t.content.constructor===Cr){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}})(n,e)}));for(const e of t)lr(e)}))},ar=(e,n,r)=>{const s=r,i=t(n.currentAttributes),o=n.right;for(;r>0&&null!==n.right;){if(!1===n.right.deleted)switch(n.right.content.constructor){case Tr:case Er:case Mr:r<n.right.length&&en(e,Ht(n.right.id.client,n.right.id.clock+r)),r-=n.right.length,n.right.delete(e)}n.forward()}o&&or(e,o,n.right,i,n.currentAttributes);const l=(n.left||n.right).parent;return l._searchMarker&&xn(l._searchMarker,n.index,-s+r),n};class hr extends _n{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)}))}get changes(){if(null===this._changes){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){const e=this.target.doc,t=[];an(e,(e=>{const n=new Map,r=new Map;let s=this.target._start,i=null;const o={};let l="",c=0,a=0;const h=()=>{if(null!==i){let e=null;switch(i){case"delete":a>0&&(e={delete:a}),a=0;break;case"insert":("object"==typeof l||l.length>0)&&(e={insert:l},n.size>0&&(e.attributes={},n.forEach(((t,n)=>{null!==t&&(e.attributes[n]=t)})))),l="";break;case"retain":c>0&&(e={retain:c},(e=>{for(const t in e)return!1;return!0})(o)||(e.attributes=x({},o))),c=0}e&&t.push(e),i=null}};for(;null!==s;){switch(s.content.constructor){case Tr:case Er:this.adds(s)?this.deletes(s)||(h(),i="insert",l=s.content.getContent()[0],h()):this.deletes(s)?("delete"!==i&&(h(),i="delete"),a+=1):s.deleted||("retain"!==i&&(h(),i="retain"),c+=1);break;case Mr:this.adds(s)?this.deletes(s)||("insert"!==i&&(h(),i="insert"),l+=s.content.str):this.deletes(s)?("delete"!==i&&(h(),i="delete"),a+=s.length):s.deleted||("retain"!==i&&(h(),i="retain"),c+=s.length);break;case Cr:{const{key:t,value:l}=s.content;if(this.adds(s)){if(!this.deletes(s)){const c=n.get(t)||null;Xn(c,l)?null!==l&&s.delete(e):("retain"===i&&h(),Xn(l,r.get(t)||null)?delete o[t]:o[t]=l)}}else if(this.deletes(s)){r.set(t,l);const e=n.get(t)||null;Xn(e,l)||("retain"===i&&h(),o[t]=e)}else if(!s.deleted){r.set(t,l);const n=o[t];void 0!==n&&(Xn(n,l)?null!==n&&s.delete(e):("retain"===i&&h(),null===l?delete o[t]:o[t]=l))}s.deleted||("insert"===i&&h(),tr(n,s.content));break}}s=s.right}for(h();t.length>0;){const e=t[t.length-1];if(void 0===e.retain||void 0!==e.attributes)break;t.pop()}})),this._delta=t}return this._delta}}class ur extends In{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach((e=>e()))}catch(e){console.error(e)}this._pending=null}_copy(){return new ur}clone(){const e=new ur;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new hr(this,e,t);Mn(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",t=this._start;for(;null!==t;)!t.deleted&&t.countable&&t.content.constructor===Mr&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?an(this.doc,(n=>{const r=new Gn(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const i=e[s];if(void 0!==i.insert){const o=t||"string"!=typeof i.insert||s!==e.length-1||null!==r.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof o||o.length>0)&&sr(n,this,r,o,i.attributes||{})}else void 0!==i.retain?ir(n,this,r,i.retain,i.attributes||{}):void 0!==i.delete&&ar(n,r,i.delete)}})):this._pending.push((()=>this.applyDelta(e)))}toDelta(e,t,n){const r=[],s=new Map,i=this.doc;let o="",l=this._start;function c(){if(o.length>0){const e={};let t=!1;s.forEach(((n,r)=>{t=!0,e[r]=n}));const n={insert:o};t&&(n.attributes=e),r.push(n),o=""}}const a=()=>{for(;null!==l;){if(Wt(l,e)||void 0!==t&&Wt(l,t))switch(l.content.constructor){case Mr:{const r=s.get("ychange");void 0===e||Wt(l,e)?void 0===t||Wt(l,t)?void 0!==r&&(c(),s.delete("ychange")):void 0!==r&&r.user===l.id.client&&"added"===r.type||(c(),s.set("ychange",n?n("added",l.id):{type:"added"})):void 0!==r&&r.user===l.id.client&&"removed"===r.type||(c(),s.set("ychange",n?n("removed",l.id):{type:"removed"})),o+=l.content.str;break}case Tr:case Er:{c();const e={insert:l.content.getContent()[0]};if(s.size>0){const t={};e.attributes=t,s.forEach(((e,n)=>{t[n]=e}))}r.push(e);break}case Cr:Wt(l,e)&&(c(),tr(s,l.content))}l=l.right}c()};return e||t?an(i,(n=>{e&&zt(n,e),t&&zt(n,t),a()}),"cleanup"):a(),r}insert(e,t,n){if(t.length<=0)return;const r=this.doc;null!==r?an(r,(r=>{const s=Qn(r,this,e);n||(n={},s.currentAttributes.forEach(((e,t)=>{n[t]=e}))),sr(r,this,s,t,n)})):this._pending.push((()=>this.insert(e,t,n)))}insertEmbed(e,t,n={}){const r=this.doc;null!==r?an(r,(r=>{const s=Qn(r,this,e);sr(r,this,s,t,n)})):this._pending.push((()=>this.insertEmbed(e,t,n)))}delete(e,t){if(0===t)return;const n=this.doc;null!==n?an(n,(n=>{ar(n,Qn(n,this,e),t)})):this._pending.push((()=>this.delete(e,t)))}format(e,t,n){if(0===t)return;const r=this.doc;null!==r?an(r,(r=>{const s=Qn(r,this,e);null!==s.right&&ir(r,this,s,t,n)})):this._pending.push((()=>this.format(e,t,n)))}removeAttribute(e){null!==this.doc?an(this.doc,(t=>{Bn(t,this,e)})):this._pending.push((()=>this.removeAttribute(e)))}setAttribute(e,t){null!==this.doc?an(this.doc,(n=>{Hn(n,this,e,t)})):this._pending.push((()=>this.setAttribute(e,t)))}getAttribute(e){return $n(this,e)}getAttributes(){return Wn(this)}_write(e){e.writeTypeRef(Ar)}}class dr{constructor(e,t=(()=>!0)){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do{if(t=e.content.type,e.deleted||t.constructor!==gr&&t.constructor!==fr||null===t._start)for(;null!==e;){if(null!==e.right){e=e.right;break}e=e.parent===this._root?null:e.parent._item}else e=t._start}while(null!==e&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,null===e?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class fr extends In{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new fr}clone(){const e=new fr;return e.insert(0,this.toArray().map((e=>e instanceof In?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new dr(this,e)}querySelector(e){e=e.toUpperCase();const t=new dr(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),c(new dr(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)))}_callObserver(e,t){Mn(this,e,new pr(this,t,e))}toString(){return Nn(this,(e=>e.toString())).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const r=e.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),An(this,(s=>{r.insertBefore(s.toDOM(e,t,n),null)})),r}insert(e,t){null!==this.doc?an(this.doc,(n=>{Rn(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)an(this.doc,(n=>{const r=e&&e instanceof In?e._item:e;Un(n,this,r,t)}));else{const n=this._prelimContent,r=null===e?0:n.findIndex((t=>t===e))+1;if(0===r&&null!==e)throw ve("Reference item not found");n.splice(r,0,...t)}}delete(e,t=1){null!==this.doc?an(this.doc,(n=>{Fn(n,this,e,t)})):this._prelimContent.splice(e,t)}toArray(){return On(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return jn(this,e)}slice(e=0,t=this.length){return Ln(this,e,t)}forEach(e){An(this,e)}_write(e){e.writeTypeRef(Pr)}}class gr extends fr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach(((e,t)=>{this.setAttribute(t,e)})),this._prelimAttrs=null}_copy(){return new gr(this.nodeName)}clone(){const e=new gr(this.nodeName);return((e,t)=>{for(const n in e)t(e[n],n)})(this.getAttributes(),((t,n)=>{"string"==typeof t&&e.setAttribute(n,t)})),e.insert(0,this.toArray().map((e=>e instanceof In?e.clone():e))),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const t in e)n.push(t);n.sort();const r=n.length;for(let s=0;s<r;s++){const r=n[s];t.push(r+'="'+e[r]+'"')}const s=this.nodeName.toLocaleLowerCase();return`<${s}${t.length>0?" "+t.join(" "):""}>${super.toString()}</${s}>`}removeAttribute(e){null!==this.doc?an(this.doc,(t=>{Bn(t,this,e)})):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?an(this.doc,(n=>{Hn(n,this,e,t)})):this._prelimAttrs.set(e,t)}getAttribute(e){return $n(this,e)}hasAttribute(e){return zn(this,e)}getAttributes(){return Wn(this)}toDOM(e=document,t={},n){const r=e.createElement(this.nodeName),s=this.getAttributes();for(const e in s){const t=s[e];"string"==typeof t&&r.setAttribute(e,t)}return An(this,(s=>{r.appendChild(s.toDOM(e,t,n))})),void 0!==n&&n._createAssociation(r,this),r}_write(e){e.writeTypeRef(Nr),e.writeKey(this.nodeName)}}class pr extends _n{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach((e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)}))}}class wr extends Yn{constructor(e){super(),this.hookName=e}_copy(){return new wr(this.hookName)}clone(){const e=new wr(this.hookName);return this.forEach(((t,n)=>{e.set(n,t)})),e}toDOM(e=document,t={},n){const r=t[this.hookName];let s;return s=void 0!==r?r.createDom(this):document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(jr),e.writeKey(this.hookName)}}class mr extends ur{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new mr}clone(){const e=new mr;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const r=e.createTextNode(this.toString());return void 0!==n&&n._createAssociation(r,this),r}toString(){return this.toDelta().map((e=>{const t=[];for(const n in e.attributes){const r=[];for(const t in e.attributes[n])r.push({key:t,value:e.attributes[n][t]});r.sort(((e,t)=>e.key<t.key?-1:1)),t.push({nodeName:n,attrs:r})}t.sort(((e,t)=>e.nodeName<t.nodeName?-1:1));let n="";for(let e=0;e<t.length;e++){const r=t[e];n+=`<${r.nodeName}`;for(let e=0;e<r.attrs.length;e++){const t=r.attrs[e];n+=` ${t.key}="${t.value}"`}n+=">"}n+=e.insert;for(let e=t.length-1;e>=0;e--)n+=`</${t[e].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Ur)}}class yr{constructor(e,t){this.id=e,this.length=t}get deleted(){throw _e()}mergeWith(e){return!1}write(e,t,n){throw _e()}integrate(e,t){throw _e()}}class br extends yr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),Xt(e.doc.store,this)}write(e,t){e.writeInfo(0),e.writeLen(this.length-t)}getMissing(e,t){return null}}class vr{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new vr(this.content)}splice(e){throw _e()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class _r{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new _r(this.len)}splice(e){const t=new _r(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){gt(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const kr=(e,t)=>new vt({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class Sr{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new Sr(kr(this.doc.guid,this.opts))}splice(e){throw _e()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class Er{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new Er(this.embed)}splice(e){throw _e()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class Cr{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new Cr(this.key,this.value)}splice(e){throw _e()}mergeWith(e){return!1}integrate(e,t){const n=t.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}class Dr{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Dr(this.arr)}splice(e){const t=new Dr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const t=this.arr[r];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}class xr{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new xr(this.arr)}splice(e){const t=new xr(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const t=this.arr[r];e.writeAny(t)}}getRef(){return 8}}class Mr{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Mr(this.str)}splice(e){const t=new Mr(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+" ",t.str=" "+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}const Ir=[e=>new qn,e=>new Yn,e=>new ur,e=>new gr(e.readKey()),e=>new fr,e=>new wr(e.readKey()),e=>new mr],Lr=0,Or=1,Ar=2,Nr=3,Pr=4,jr=5,Ur=6;class Tr{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Tr(this.type._copy())}splice(e){throw _e()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;null!==t;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach((t=>{t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e)})),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;null!==t;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach((t=>{for(;null!==t;)t.gc(e,!0),t=t.left})),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Rr=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new Fr(Ht(r,s+n),t,Ht(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),null!==t.redone&&(i.redone=Ht(t.redone.client,t.redone.clock+n)),t.right=i,null!==i.right&&(i.right.left=i),e._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),t.length=n,i};class Fr extends yr{constructor(e,t,n,r,s,i,o,l){super(e,l.getLength()),this.origin=n,this.left=t,this.right=r,this.rightOrigin=s,this.parent=i,this.parentSub=o,this.redone=null,this.content=l,this.info=this.content.isCountable()?2:0}set marker(e){(8&this.info)>0!==e&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Yt(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Yt(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Ft&&this.id.client!==this.parent.client&&this.parent.clock>=Yt(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=tn(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=en(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===br||this.right&&this.right.constructor===br)&&(this.parent=null),this.parent){if(this.parent.constructor===Ft){const e=Zt(t,this.parent);e.constructor===br?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===Fr&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Fr&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=tn(e,e.doc.store,Ht(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,n=this.left;if(null!==n)t=n.right;else if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start;const r=new Set,s=new Set;for(;null!==t&&t!==this.right;){if(s.add(t),r.add(t),Bt(this.origin,t.origin)){if(t.id.client<this.id.client)n=t,r.clear();else if(Bt(this.rightOrigin,t.rightOrigin))break}else{if(null===t.origin||!s.has(Zt(e.doc.store,t.origin)))break;r.has(Zt(e.doc.store,t.origin))||(n=t,r.clear())}t=t.right}this.left=n}if(null!==this.left){const e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),Xt(e.doc.store,this),this.content.integrate(e,this),on(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new br(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;null!==e&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;null!==e&&e.deleted;)e=e.left;return e}get lastId(){return 1===this.length?this.id:Ht(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Bt(e.origin,this.lastId)&&this.right===e&&Bt(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach((t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))})),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),gt(e.deleteSet,this.id.client,this.id.clock,this.length),on(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw ke();this.content.gc(e),t?((e,t,n)=>{const r=e.clients.get(t.id.client);r[Gt(r,t.id.clock)]=n})(e,this,new br(this.id,this.length)):this.content=new _r(this.length)}write(e,t){const n=t>0?Ht(this.id.client,this.id.clock+t-1):this.origin,r=this.rightOrigin,s=this.parentSub,i=31&this.content.getRef()|(null===n?0:K)|(null===r?0:q)|(null===s?0:32);if(e.writeInfo(i),null!==n&&e.writeLeftID(n),null!==r&&e.writeRightID(r),null===n&&null===r){const t=this.parent;if(void 0!==t._item){const n=t._item;if(null===n){const n=(e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw ke()})(t);e.writeParentInfo(!0),e.writeString(n)}else e.writeParentInfo(!1),e.writeLeftID(n.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===Ft?(e.writeParentInfo(!1),e.writeLeftID(t)):ke();null!==s&&e.writeString(s)}this.content.write(e,t)}}const Br=(e,t)=>Hr[31&t](e),Hr=[()=>{ke()},e=>new _r(e.readLen()),e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const t=e.readString();"undefined"===t?n.push(void 0):n.push(JSON.parse(t))}return new Dr(n)},e=>new vr(e.readBuf()),e=>new Mr(e.readString()),e=>new Er(e.readJSON()),e=>new Cr(e.readKey(),e.readJSON()),e=>new Tr(Ir[e.readTypeRef()](e)),e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new xr(n)},e=>new Sr(kr(e.readString(),e.readAny())),()=>{ke()}];class $r extends yr{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){ke()}write(e,t){e.writeInfo(10),se(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const Wr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},zr="__ $YJS$ __";!0===Wr[zr]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Wr[zr]=!0;const Jr=new Map,Vr="undefined"==typeof BroadcastChannel?class{constructor(e){var t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:V(t.newValue||"")}),t=this._onChange,C||addEventListener("storage",t)}postMessage(e){D.setItem(this.room,J(new Uint8Array(e)))}close(){var e;e=this._onChange,C||removeEventListener("storage",e)}}:BroadcastChannel,qr=e=>s(Jr,e,(()=>{const t=i(),n=new Vr(e);return n.onmessage=e=>t.forEach((t=>t(e.data,"broadcastchannel"))),{bc:n,subs:t}})),Kr=(e,t,n=null)=>{const r=qr(e);r.bc.postMessage(t),r.subs.forEach((e=>e(t,n)))},Yr=(e,t)=>{se(e,0);const n=(e=>((e,t=new xt)=>(e instanceof Map?Nt(t,e):((e,t)=>{Nt(e,Kt(t.store))})(t,e),t.toUint8Array()))(e,new Ct))(t);he(e,n)},Xr=(e,t,n)=>{se(e,1),he(e,((e,t)=>Ot(e,t,new Dt))(t,n))},Gr=(e,t,n)=>{try{((e,t,n)=>{Lt(e,t,n,kt)})(t,xe(e),n)}catch(e){console.error("Caught error while handling a Yjs update",e)}},Zr=Gr;class Qr extends h{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=Ke();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((n,r)=>{r!==this.clientID&&3e4<=e-n.lastUpdated&&this.states.has(r)&&t.push(r)})),t.length>0&&es(this,t,"timeout")}),u(3e3)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),r=void 0===n?0:n.clock+1,s=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:r,lastUpdated:Ke()});const i=[],o=[],l=[],c=[];null===e?c.push(t):null==s?null!=e&&i.push(t):(o.push(t),N(s,e)||l.push(t)),(i.length>0||l.length>0||c.length>0)&&this.emit("change",[{added:i,updated:l,removed:c},"local"]),this.emit("update",[{added:i,updated:o,removed:c},"local"])}setLocalStateField(e,t){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const es=(e,t,n)=>{const r=[];for(let n=0;n<t.length;n++){const s=t[n];if(e.states.has(s)){if(e.states.delete(s),s===e.clientID){const t=e.meta.get(s);e.meta.set(s,{clock:t.clock+1,lastUpdated:Ke()})}r.push(s)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},ts=(e,t,n=e.states)=>{const r=t.length,s=Q();se(s,r);for(let i=0;i<r;i++){const r=t[i],o=n.get(r)||null,l=e.meta.get(r).clock;se(s,r),se(s,l),ce(s,JSON.stringify(o))}return te(s)},ns=[];ns[0]=(e,t,n,r,s)=>{se(e,0);const i=((e,t,n,r)=>{const s=Ie(e);switch(s){case 0:((e,t,n)=>{Xr(t,n,xe(e))})(e,t,n);break;case 1:Gr(e,n,r);break;case 2:Zr(e,n,r);break;default:throw new Error("Unknown message type")}return s})(t,e,n.doc,n);r&&1===i&&!n.synced&&(n.synced=!0)},ns[3]=(e,t,n,r,s)=>{se(e,1),he(e,ts(n.awareness,Array.from(n.awareness.getStates().keys())))},ns[1]=(e,t,n,r,s)=>{((e,t,n)=>{const r=De(t),s=Ke(),i=[],o=[],l=[],c=[],a=Ie(r);for(let t=0;t<a;t++){const t=Ie(r);let n=Ie(r);const a=JSON.parse(Oe(r)),h=e.meta.get(t),u=e.states.get(t),d=void 0===h?0:h.clock;(d<n||d===n&&null===a&&e.states.has(t))&&(null===a?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,a),e.meta.set(t,{clock:n,lastUpdated:s}),void 0===h&&null!==a?i.push(t):void 0!==h&&null===a?c.push(t):null!==a&&(N(a,u)||l.push(t),o.push(t)))}(i.length>0||l.length>0||c.length>0)&&e.emit("change",[{added:i,updated:l,removed:c},n]),(i.length>0||o.length>0||c.length>0)&&e.emit("update",[{added:i,updated:o,removed:c},n])})(n.awareness,xe(t),n)},ns[2]=(e,t,n,r,s)=>{((e,t,n)=>{0===Ie(e)&&n(0,Oe(e))})(t,n.doc,((e,t)=>rs(n,t)))};const rs=(e,t)=>console.warn(`Permission denied to access ${e.url}.\n${t}`),ss=(e,t,n)=>{const r=De(t),s=Q(),i=Ie(r),o=e.messageHandlers[i];return o?o(s,r,e,n,i):console.error("Unable to compute message"),s},is=e=>{if(e.shouldConnect&&null===e.ws){const t=new e._WS(e.url);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=n=>{e.wsLastMessageReceived=Ke();const r=ss(e,new Uint8Array(n.data),!0);ee(r)>1&&t.send(te(r))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=t=>{e.emit("connection-close",[t,e]),e.ws=null,e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,es(e.awareness,Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID)),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(is,f(100*p(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e)},t.onopen=()=>{e.wsLastMessageReceived=Ke(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const n=Q();if(se(n,0),Yr(n,e.doc),t.send(te(n)),null!==e.awareness.getLocalState()){const n=Q();se(n,1),he(n,ts(e.awareness,[e.doc.clientID])),t.send(te(n))}},e.emit("status",[{status:"connecting"}])}},os=(e,t)=>{const n=e.ws;e.wsconnected&&n&&n.readyState===n.OPEN&&n.send(t),e.bcconnected&&Kr(e.bcChannel,t,e)};class ls extends h{constructor(e,t,n,{connect:r=!0,awareness:s=new Qr(n),params:i={},WebSocketPolyfill:o=WebSocket,resyncInterval:l=-1,maxBackoffTime:c=2500,disableBc:a=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);const h=(e=>((e,t)=>{const n=[];for(const r in e)n.push(t(e[r],r));return n})(e,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&"))(i);this.maxBackoffTime=c,this.bcChannel=e+"/"+t,this.url=e+"/"+t+(0===h.length?"":"?"+h),this.roomname=t,this.doc=n,this._WS=o,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=a,this.wsUnsuccessfulReconnects=0,this.messageHandlers=ns.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=r,this._resyncInterval=0,l>0&&(this._resyncInterval=setInterval((()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const e=Q();se(e,0),Yr(e,n),this.ws.send(te(e))}}),l)),this._bcSubscriber=(e,t)=>{if(t!==this){const t=ss(this,new Uint8Array(e),!1);ee(t)>1&&Kr(this.bcChannel,te(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){const t=Q();se(t,0),((e,t)=>{se(e,2),he(e,t)})(t,e),os(this,te(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:n},r)=>{const i=e.concat(t).concat(n),o=Q();se(o,1),he(o,ts(s,i)),os(this,te(o))},this._unloadHandler=()=>{es(this.awareness,[n.clientID],"window unload")},"undefined"!=typeof window?window.addEventListener("unload",this._unloadHandler):"undefined"!=typeof process&&process.on("exit",this._unloadHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval((()=>{this.wsconnected&&3e4<Ke()-this.wsLastMessageReceived&&this.ws.close()}),3e3),r&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),"undefined"!=typeof window?window.removeEventListener("unload",this._unloadHandler):"undefined"!=typeof process&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;var e,t;this.bcconnected||(e=this.bcChannel,t=this._bcSubscriber,qr(e).subs.add(t),this.bcconnected=!0);const n=Q();se(n,0),Yr(n,this.doc),Kr(this.bcChannel,te(n),this);const r=Q();se(r,0),Xr(r,this.doc),Kr(this.bcChannel,te(r),this);const s=Q();se(s,3),Kr(this.bcChannel,te(s),this);const i=Q();se(i,1),he(i,ts(this.awareness,[this.doc.clientID])),Kr(this.bcChannel,te(i),this)}disconnectBc(){const e=Q();se(e,1),he(e,ts(this.awareness,[this.doc.clientID],new Map)),os(this,te(e)),this.bcconnected&&(((e,t)=>{const n=qr(e);n.subs.delete(t)&&0===n.subs.size&&(n.bc.close(),Jr.delete(e))})(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(is(this),this.connectBc())}}const{v4:cs}=n(429),as=n(479);function hs(e,t){const n=as.diffChars(e,t),r=[];return n.forEach((e=>{e.added?r.push({insert:e.value}):e.removed?r.push({delete:e.count}):e.value&&r.push({retain:e.count})})),r.forEach((e=>{e.insert&&"\n"===e.insert.slice(-1)&&(e.insert=e.insert.slice(0,-1))})),r}class us{constructor(){this.dbName="rooms",indexedDB.open(this.dbName,1).onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("rooms")||t.createObjectStore("rooms",{keyPath:"roomId"}).createIndex("roomName","roomName",{unique:!1})}}#e(){return cs()}#t(e){return new Promise(((t,n)=>{const r=indexedDB.open(this.dbName);r.onsuccess=r=>e(r.target.result,t,n),r.onerror=()=>n(r.error)}))}#n(e,t){return e.transaction(["rooms"],t).objectStore("rooms")}createRoom(e,t,n=null){null===n&&(n=this.#e());const r={roomId:n,roomName:e,password:t,lastAccessTime:new Date,payload:null};return this.#t(((e,t,n)=>{this.#n(e,"readwrite").add(r).onsuccess=()=>t(r)}))}createRoomById(e,t,n){return new Promise(((r,s)=>{this.findRoomById(e).then((i=>{if(i)s(new Error("A room with the same ID already exists."));else{const i={roomId:e,roomName:t,password:n,lastAccessTime:new Date,payload:null};this.#t(((e,t,n)=>{this.#n(e,"readwrite").add(i).onsuccess=()=>t(i)})).then(r).catch(s)}})).catch(s)}))}findAllRooms(){return this.#t(((e,t,n)=>{this.#n(e,"readonly").getAll().onsuccess=e=>t(e.target.result)}))}findRoomById(e){return this.#t(((t,n,r)=>{this.#n(t,"readonly").get(e).onsuccess=e=>n(e.target.result)}))}findRoomByName(e){return this.#t(((t,n,r)=>{this.#n(t,"readonly").index("roomName").get(e).onsuccess=e=>n(e.target.result)}))}updateRoom(e,t=null,n=null){if(null==t||null==n){const r=this.findRoomById(e);t=r.roomName,n=r.password}return this.#t(((r,s,i)=>{const o=this.#n(r,"readwrite"),l=o.get(e);l.onsuccess=()=>{const e=l.result;e.roomName=t,e.password=n,e.lastAccessTime=new Date,e.payload=null,o.put(e).onsuccess=()=>s(e)},l.onerror=()=>i(l.error)}))}deleteRoom(e){return this.#t(((t,n,r)=>{this.#n(t,"readwrite").delete(e).onsuccess=()=>n(!0)}))}}class ds{constructor({host:e="ws://localhost",port:t="1234",room:n="room",password:r="",timeout:s=1e3}={}){this.ydoc=new vt,this.provider=null,this.awareness=null,this.cursor={},this.host=e,this.port=t,this.room=n,this.password=r,this.timeout=s,this.oldText="",this.syncElements={},this.trackedElements=[],this.positions={}}connect({host:e=null,port:t=null,room:n=null,password:r=null,timeout:s=null}={}){return null!=e&&(this.host=e),null!=t&&(this.port=t),null!=n&&(this.room=n),null!=r&&(this.password=r),null!=s&&(this.timeout=s),new Promise(((e,t)=>{try{this.provider=new ls(`${this.host}:${this.port}`,`${this.room}?password=${this.password}`,this.ydoc),this.provider.shouldConnect=!1,this.provider.on("status",(n=>{console.log(n);let r=0;const s=n=>{this.provider.synced?e("Connection successful"):r>10?t("Connection error"):(r++,setTimeout(s,n/10))};s(this.timeout)}))}catch(e){t(e)}}))}#r(e){this.positions={};for(const t of this.trackedElements){const n=e.clientX,r=e.clientY,s=t.getBoundingClientRect(),i=t.scrollLeft||0,o=t.scrollTop||0,l=n-s.left+i,c=r-s.top+o;this.positions[t.id]={x:l,y:c}}this.awareness.setLocalStateField("cursor",this.positions)}addSyncCursolElement(e){const t=document.getElementById(e);t.style.cursor="none",t?(this.trackedElements.push(t),1===this.trackedElements.length&&(window.onmousemove=this.#r.bind(this))):console.error(`Element with ID ${e} not found.`)}sampleCursorCallback(e,t){const n=document.getElementById(t);n.innerHTML="",e.forEach((function(e,t){if("cursor"in e)for(let[t,s]of Object.entries(e.cursor)){const i=document.getElementById(t),o=i.getBoundingClientRect(),l=16,c=16,a=i.scrollLeft||0,h=i.scrollTop||0;let u=s.x+i.getBoundingClientRect().left-a-l/2,d=s.y+i.getBoundingClientRect().top-h-c/2;if(s.x-a>=0&&s.x-a<=o.width&&s.y-h>=0&&s.y-h<=o.height){let t=document.createElement("div");t.style.width=l+"px",t.style.height=c+"px",t.style.borderRadius="50%",t.style.borderWidth="3px",t.style.borderStyle="solid",t.style.borderColor=e.user.color,t.style.backgroundColor="transparent",t.style.position="absolute",t.className="cursor",t.style.pointerEvents="none",t.style.left=u+"px",t.style.top=d+"px",t.style.zIndex="1000";var r=document.createElement("span");r.style.position="absolute",r.style.bottom="0px",r.style.fontSize="9.5px",r.style.color=e.user.color,r.style.pointerEvents="none",r.textContent=e.user.name,s.x-a>o.width/2?r.style.right="20px":r.style.left="20px",t.appendChild(r),n.appendChild(t)}}}))}setupAwareness(e,t,n=null,r=null){this.awareness=this.provider.awareness,this.awareness.on("change",(e=>{const t=this.awareness.states;r(t,n)})),this.awareness.setLocalStateField("user",{name:e,color:t})}startSyncDictionary(e,t){if(!(e in this.syncElements)){const n=this.ydoc.getMap(e),r=n.observe((e=>{t(e,n)}));return this.syncElements[e]={ymap:n,observer:r},console.log(`Started syncing dictionary with name: ${e}`),{setItem:(e,t)=>{n.set(e,t)},getItem:e=>n.get(e),deleteItem:e=>n.delete(e),getDictionary:()=>n.toJSON()}}console.warn(`Name ${e} is already being observed.`)}startSyncJson(e,t){if(!(e in this.syncElements)){const n=this.ydoc.getText(e),r=n.observe((e=>{t(e,n)}));return this.syncElements[e]={ytext:n,observer:r},console.log(`Started syncing JSON with name: ${e}`),{updateJson:e=>{const t=hs(n.toString(),e);n.applyDelta(t)},getJson:()=>n.toString()}}console.warn(`Name ${e} is already being observed.`)}addSyncElement(e){if(e in this.syncElements)console.warn(`Element with ID ${e} is already being observed.`);else{const t=document.getElementById(e);if(!t)return void console.error(`Element with ID ${e} not found.`);function n(t,n){this.syncElements[e].observer.disconnect();const r=this.syncElements[e].element.innerHTML,s=hs(this.oldText,r);this.syncElements[e].ytext.applyDelta(s),this.oldText=r,this.syncElements[e].observer.observe(this.syncElements[e].element,o)}function r(){this.syncElements[e].element.id;const t=this.syncElements[e].ytext.toString();this.syncElements[e].element.innerHTML==t||this.oldText==t||(this.oldText=t,this.syncElements[e].element.innerHTML=t)}const s=n.bind(this),i=r.bind(this);this.syncElements[e]={ytext:this.ydoc.getText(e),element:t,observer:new MutationObserver(((e,t)=>s(e,t)))},i(),this.syncElements[e].ytext.observe((()=>{i()}));const o={attributes:!0,childList:!0,subtree:!0};this.syncElements[e].observer.observe(this.syncElements[e].element,o)}}removeSyncData(e){this.syncElements[e].ytext.delete(0,this.syncElements[e].ytext.length)}removeSyncElement(e){this.syncElements[e].observer.disconnect(),delete this.syncElements[e]}}const fs=class extends ds{constructor({host:e="ws://localhost",port:t="1234",room:n="room",password:r="",timeout:s=1e3}={}){super({host:e,port:t,room:n,password:r,timeout:s}),this.rooms=new us}async createRoom(e,t,n=null){return await this.rooms.createRoom(e,t,n)}async createRoomById(e,t,n){return await this.rooms.createRoomById(e,t,n)}async getRoomById(e){return await this.rooms.findRoomById(e)}async getRoomByName(e){return await this.rooms.findRoomByName(e)}async updateRoom(e,t,n){return await this.rooms.updateRoom(e,t,n)}async deleteRoom(e){return await this.rooms.deleteRoom(e)}async getAllRooms(){return await this.rooms.findAllRooms()}async connectRoom(e){const t=await this.rooms.findRoomByName(e);return this.rooms.updateRoom(t.roomId),this.connect({name:t.roomId,password:t.password})}}})(),IsariBackend=r.default})();